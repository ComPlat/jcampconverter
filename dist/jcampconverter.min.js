!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JcampConverter=t():e.JcampConverter=t()}(this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var i=a[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";function r(){function e(e){for(var t=e.length,a=new Array(t),r=0;t>r;r++)a[r]=parseFloat(e[r]);return a}function t(t,l){l=l||{};var p=/^$/;l.keepRecordsRegExp&&(p=l.keepRecordsRegExp);var d,g,v,m,F,y,x,X,A,b=new Date,T={},C={};C.profiling=[],C.logs=[];var S=[];C.spectra=S,C.info={};var O={};if("string"!=typeof t)return C;for(C.profiling&&C.profiling.push({action:"Before split to LDRS",time:new Date-b}),m=t.split(/[\r\n]+##/),C.profiling&&C.profiling.push({action:"Split to LDRS",time:new Date-b}),m[0]&&(m[0]=m[0].replace(/^[\r\n ]*##/,"")),F=0,y=m.length;y>F;F++){if(d=m[F],x=d.indexOf("="),x>0?(g=d.substring(0,x),v=d.substring(x+1).trim()):(g=d,v=""),g=g.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===g&&(X=v.indexOf("\n"),-1===X&&(X=v.indexOf("\r")),X>0)){var E=-1,R=-1;if(A=v.substring(0,X).split(/[ ,;\t]+/),A[0].indexOf("++")>0){var w=A[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),Y=A[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");E=T.symbol.indexOf(w),R=T.symbol.indexOf(Y)}-1===E&&(E=0),-1===R&&(R=0),T.first&&(T.first.length>E&&(O.firstX=T.first[E]),T.first.length>R&&(O.firstY=T.first[R])),T.last&&(T.last.length>E&&(O.lastX=T.last[E]),T.last.length>R&&(O.lastY=T.last[R])),T.vardim&&T.vardim.length>E&&(O.nbPoints=T.vardim[E]),T.factor&&(T.factor.length>E&&(O.xFactor=T.factor[E]),T.factor.length>R&&(O.yFactor=T.factor[R])),T.units&&(T.units.length>E&&(O.xUnit=T.units[E]),T.units.length>R&&(O.yUnit=T.units[R])),O.datatable=A[0],A[1]&&A[1].indexOf("PEAKS")>-1?g="PEAKTABLE":A[1]&&(A[1].indexOf("XYDATA")||A[0].indexOf("++")>0)&&(g="XYDATA",O.deltaX=(O.lastX-O.firstX)/(O.nbPoints-1))}if("TITLE"===g)O.title=v;else if("DATATYPE"===g)O.dataType=v,v.indexOf("nD")>-1&&(C.twoD=!0);else if("NTUPLES"===g)v.indexOf("nD")>-1&&(C.twoD=!0);else if("XUNITS"===g)O.xUnit=v;else if("YUNITS"===g)O.yUnit=v;else if("FIRSTX"===g)O.firstX=parseFloat(v);else if("LASTX"===g)O.lastX=parseFloat(v);else if("FIRSTY"===g)O.firstY=parseFloat(v);else if("LASTY"===g)O.lastY=parseFloat(v);else if("NPOINTS"===g)O.nbPoints=parseFloat(v);else if("XFACTOR"===g)O.xFactor=parseFloat(v);else if("YFACTOR"===g)O.yFactor=parseFloat(v);else if("DELTAX"===g)O.deltaX=parseFloat(v);else if(".OBSERVEFREQUENCY"===g||"$SFO1"===g)O.observeFrequency||(O.observeFrequency=parseFloat(v));else if(".OBSERVENUCLEUS"===g)O.xType||(C.xType=v.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===g)C.indirectFrequency||(C.indirectFrequency=parseFloat(v));else if("$OFFSET"===g)C.shiftOffsetNum=0,C.shiftOffsetVal||(C.shiftOffsetVal=parseFloat(v));else if("$REFERENCEPOINT"===g);else if("VARNAME"===g)T.varname=v.split(h);else if("SYMBOL"===g)T.symbol=v.split(h);else if("VARTYPE"===g)T.vartype=v.split(h);else if("VARFORM"===g)T.varform=v.split(h);else if("VARDIM"===g)T.vardim=e(v.split(h));else if("UNITS"===g)T.units=v.split(h);else if("FACTOR"===g)T.factor=e(v.split(h));else if("FIRST"===g)T.first=e(v.split(h));else if("LAST"===g)T.last=e(v.split(h));else if("MIN"===g)T.min=e(v.split(h));else if("MAX"===g)T.max=e(v.split(h));else if(".NUCLEUS"===g)C.twoD&&(C.yType=v.split(h)[0]);else if("PAGE"===g){O.page=v.trim(),O.pageValue=parseFloat(v.replace(/^.*=/,"")),O.pageSymbol=O.page.replace(/=.*/,"");var P=T.symbol.indexOf(O.pageSymbol),D="";T.units&&T.units[P]&&(D=T.units[P]),C.indirectFrequency&&"PPM"!==D&&(O.pageValue/=C.indirectFrequency)}else"RETENTIONTIME"===g?O.pageValue=parseFloat(v):"XYDATA"===g?(n(C,O),v.match(/.*\+\+.*/)?l.fastParse===!1?o(O,v,C):u(O,v,C):c(O,v,C),S.push(O),O={}):"PEAKTABLE"===g?(n(C,O),c(O,v,C),S.push(O),O={}):r(g)&&(O[a(g)]=v);g.match(p)&&(C.info[g]=v.trim())}if(C.profiling&&C.profiling.push({action:"Finished parsing",time:new Date-b}),Object.keys(T).length>0){for(var U=[],M=Object.keys(T),F=0;F<M.length;F++)for(var L=M[F],N=T[L],V=0;V<N.length;V++)U[V]||(U[V]={}),U[V][L]=N[V];C.ntuples=U}C.twoD&&(f(C),C.profiling&&C.profiling.push({action:"Finished countour plot calculation",time:new Date-b}),l.keepSpectra||delete C.spectra);var I=S.length>1&&(!S[0].dataType||S[0].dataType.match(/.*mass.*/i));if(I&&l.newGCMS&&(l.xy=!0),l.xy&&S.length>0)for(var F=0;F<S.length;F++){var O=S[F];if(O.data.length>0)for(var V=0;V<O.data.length;V++){for(var q=O.data[V],$={x:new Array(q.length/2),y:new Array(q.length/2)},k=0;k<q.length;k+=2)$.x[k/2]=q[k],$.y[k/2]=q[k+1];O.data[V]=$}}return I&&(l.newGCMS?i(C):s(C),C.profiling&&C.profiling.push({action:"Finished GCMS calculation",time:new Date-b})),C.profiling&&C.profiling.push({action:"Total time",time:new Date-b}),C}function a(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function r(e){return-1!==d.indexOf(e)}function i(e){var t,r=e.spectra,i=r.length,s={times:new Array(i),series:[{name:"ms",dimension:2,data:new Array(i)}]},n=[];for(t=0;t<d.length;t++){var l=a(d[t]);r[0][l]&&(n.push(l),s.series.push({name:l,dimension:1,data:new Array(i)}))}for(t=0;i>t;t++){var o=r[t];s.times[t]=o.pageValue;for(var f=0;f<n.length;f++)s.series[f+1].data[t]=parseFloat(o[n[f]]);o.data&&(s.series[0].data[t]=[o.data[0].x,o.data[0].y])}e.gcms=s}function s(e){var t,r=e.spectra,i=[];for(t=0;t<d.length;t++){var s=a(d[t]);r[0][s]&&i.push(s)}if(0!==i.length){var n={};for(n.gc={},n.ms=[],t=0;t<i.length;t++)n.gc[i[t]]=[];for(t=0;t<r.length;t++){for(var l=r[t],o=0;o<i.length;o++)n.gc[i[o]].push(l.pageValue),n.gc[i[o]].push(parseFloat(l[i[o]]));l.data&&(n.ms[t]=l.data[0])}e.gcms=n}}function n(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var a=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-a,t.lastX=t.lastX-a}}function l(e){for(var t=0,a=e[0].data[0][0],r=a,i=e.length,s=e[0].data[0].length/2,n=new Array(i),l=0;i>l;l++){n[l]=new Array(s);for(var o=0;s>o;o++)n[l][o]=e[l].data[0][2*o+1],n[l][o]<a&&(a=e[l].data[0][2*o+1]),n[l][o]>r&&(r=e[l].data[0][2*o+1]),0!==l&&0!==o&&(t+=Math.abs(n[l][o]-n[l][o-1])+Math.abs(n[l][o]-n[l-1][o]))}return{z:n,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[i-1].pageValue,minZ:a,maxZ:r,noise:t/((i-1)*(s-1)*2)}}function f(e){var t=l(e.spectra);e.contourLines=p(t),delete t.z,e.minMax=t}function p(e,t){for(var a,r,i,s,n,l,o,f,p,u,c,h,d,g=e.noise,v=e.z,m=[],F=7,y=v.length,x=v[0].length,X=e.minX,A=e.maxX,b=(A-X)/(x-1),T=e.minY,C=e.maxY,S=(C-T)/(y-1),O=e.minZ,E=e.maxZ,R=0;2*F>R;R++){var w={};m[R]=w;var Y=R%2;d=0===Y?(E-5*g)*Math.exp(R/2-F)+5*g:-(E-5*g)*Math.exp(R/2-F)-5*g;var P=[];if(w.zValue=d,w.lines=P,!(O>=d||d>=E))for(var D=0;y-1>D;D++)for(var U=0;x-1>U;U++)a=v[D][U],r=v[D][U+1],i=v[D+1][U],s=v[D+1][U+1],n=a>d,l=r>d,o=i>d,f=s>d,n!==l&&n!==o&&(p=U+(d-a)/(r-a),u=D,c=U,h=D+(d-a)/(i-a),P.push(p*b+X),P.push(u*S+T),P.push(c*b+X),P.push(h*S+T)),f!==l&&f!==o&&(p=U+1,u=D+1-(d-s)/(r-s),c=U+1-(d-s)/(i-s),h=D+1,P.push(p*b+X),P.push(u*S+T),P.push(c*b+X),P.push(h*S+T)),l!==o&&(p=(U+1-(d-r)/(i-r))*b+X,u=(D+(d-r)/(i-r))*S+T,l!==n&&(c=U+1-(d-r)/(a-r),h=D,P.push(p),P.push(u),P.push(c*b+X),P.push(h*S+T)),o!==n&&(c=U,h=D+1-(d-i)/(a-i),P.push(p),P.push(u),P.push(c*b+X),P.push(h*S+T)),l!==f&&(c=U+1,h=D+(d-r)/(s-r),P.push(p),P.push(u),P.push(c*b+X),P.push(h*S+T)),o!==f&&(c=U+(d-i)/(s-i),h=D+1,P.push(p),P.push(u),P.push(c*b+X),P.push(h*S+T)))}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:m}}function u(e,t,a){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1)),e.isXYdata=!0;var r=[],i=0;e.data=[r];for(var s=e.firstX,n=e.firstY,l=!1,o=0;o<t.length;o++){var f=t.charCodeAt(o);if(13===f||10===f)l=!0;else if(l)break}for(var f,p=!0,u=!1,c=!1,h=0,d=!1,g=!1,v=0,m=!1,F=!1,y=!1,x=0;o<=t.length;o++)if(f=o===t.length?13:t.charCodeAt(o),g)13!==f&&10!==f||(p=!0,g=!1);else if(57>=f&&f>=48)F=!0,x>0?v+=(f-48)/Math.pow(10,x++):(v*=10,v+=f-48);else if(44===f||46===f)F=!0,x++;else{if(F){if(p)p=!1,c&&(y=!0);else if(y)y=!1;else{u&&(h=m?-v:v,c=!0,u=!1);for(var X=d?v-1:1,A=0;X>A;A++)c?n+=h:n=m?-v:v,r[i++]=s,r[i++]=n*e.yFactor,s+=e.deltaX}m=!1,v=0,x=0,F=!1,d=!1}if(74>f&&f>63)F=!0,c=!1,v=f-64;else if(f>96&&106>f)F=!0,c=!1,v=f-96,m=!0;else if(115===f)F=!0,d=!0,v=9;else if(f>82&&91>f)F=!0,d=!0,v=f-82;else if(f>73&&83>f)F=!0,u=!0,v=f-73;else if(f>105&&115>f)F=!0,u=!0,v=f-105,m=!0;else if(36===f&&36===t.charCodeAt(o+1))F=!0,g=!0;else if(37===f)F=!0,u=!0,v=0,m=!1;else if(45===f){var b=t.charCodeAt(o+1);(b>=48&&57>=b||44===b||46===b)&&(F=!0,c=!1,m=!0)}else 13!==f&&10!==f||(p=!0,g=!1)}}function c(e,t,a){var r=/\$\$.*/,i=/[,\t ]+/;e.isPeaktable=!0;var s,n,l,o,f,p=[];e.data=[p];var u=t.split(/,? *,?[;\r\n]+ */),c=0;for(s=1,n=u.length;n>s;s++)if(f=u[s].trim().replace(r,"").split(i),f.length%2===0)for(l=0,o=f.length;o>l;l+=2)p[c++]=parseFloat(f[l])*e.xFactor,p[c++]=parseFloat(f[l+1])*e.yFactor;else a.logs.push("Format error: "+f)}var h=/[, \t]{1,}/,d=["TIC",".RIC","SCANNUMBER"];return t}function i(e,t,a){return"boolean"==typeof t&&(a=t,t={}),a?s(e,t):f(e,t)}function s(e,t){return l||n(),new Promise(function(a){var r=Date.now()+""+Math.random();p[r]=a,l.postMessage({stamp:r,input:e,options:t})})}function n(){var e=URL.createObjectURL(new Blob(["var getConverter ="+r.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));l=new Worker(e),URL.revokeObjectURL(e),l.addEventListener("message",function(e){var t=e.data.stamp;p[t]&&p[t](e.data.output)})}var l,o=a(1),f=r(),p={};e.exports={convert:i}},function(e,t){"use strict";var a=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,r=/\$\$.*/,i=!1;e.exports=function(e,t,s){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1)),e.isXYdata=!0;var n=[],l=0;e.data=[n];var o,f,p,u=e.firstX,c=e.firstY,h=t.split(/[\r\n]+/);f=[];for(var d=1,g=h.length;g>d;d++)if(f=h[d].trim().replace(r,"").split(a),f.length>0){if(i){e.firstPoint||(e.firstPoint=+f[0]);var v=(f[0]-e.firstPoint)*e.xFactor+e.firstX;(o||0===o)&&(v+=e.deltaX),s.logs.push("Checking X value: currentX: "+u+" - expectedCurrentX: "+v)}for(var m=1,F=f.length;F>m;m++)if(1!==m||!o&&0!==o){if(f[m].length>0)if(p=f[m].charCodeAt(0),43===p||45===p||46===p||p>47&&58>p)o=null,c=+f[m],n[l++]=u,n[l++]=c*e.yFactor,u+=e.deltaX;else if(p>63&&74>p)o=null,c=+(String.fromCharCode(p-16)+f[m].substring(1)),n[l++]=u,n[l++]=c*e.yFactor,u+=e.deltaX;else if(p>96&&106>p)o=null,c=1*-(String.fromCharCode(p-48)+f[m].substring(1)),n[l++]=u,n[l++]=c*e.yFactor,u+=e.deltaX;else if(p>82&&91>p||115===p){var y=String.fromCharCode(p-34)+f[m].substring(1)-1;115===p&&(y="9"+f[m].substring(1)-1);for(var x=0;y>x;x++)o&&(c+=o),n[l++]=u,n[l++]=c*e.yFactor,u+=e.deltaX}else 37===p?(o=+("0"+f[m].substring(1)),c+=o,n[l++]=u,n[l++]=c*e.yFactor,u+=e.deltaX):p>73&&83>p?(o=1*(String.fromCharCode(p-25)+f[m].substring(1)),c+=o,n[l++]=u,n[l++]=c*e.yFactor,u+=e.deltaX):p>105&&115>p&&(o=1*-(String.fromCharCode(p-57)+f[m].substring(1)),c+=o,n[l++]=u,n[l++]=c*e.yFactor,u+=e.deltaX)}else o=null,p=f[m].charCodeAt(0)}}}])});
//# sourceMappingURL=jcampconverter.min.js.map