!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JcampConverter=t():e.JcampConverter=t()}(this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var i=a[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t){"use strict";function a(){function e(e){for(var t=e.length,a=new Array(t),r=0;t>r;r++)a[r]=parseFloat(e[r]);return a}function t(t,l){l=l||{};var p=/^$/;l.keepRecordsRegExp&&(p=l.keepRecordsRegExp);var u,c,g,h,d,v,m,F,y,x=new Date,X={},A={};A.profiling=[],A.logs=[];var b=[];A.spectra=b,A.info={};var T={};if("string"!=typeof t)return A;for(A.profiling&&A.profiling.push({action:"Before split to LDRS",time:new Date-x}),h=t.split(/[\r\n]+##/),A.profiling&&A.profiling.push({action:"Split to LDRS",time:new Date-x}),h[0]&&(h[0]=h[0].replace(/^[\r\n ]*##/,"")),d=0,v=h.length;v>d;d++){if(u=h[d],m=u.indexOf("="),m>0?(c=u.substring(0,m),g=u.substring(m+1).trim()):(c=u,g=""),c=c.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===c&&(F=g.indexOf("\n"),-1===F&&(F=g.indexOf("\r")),F>0)){var C=-1,O=-1;if(y=g.substring(0,F).split(/[ ,;\t]+/),y[0].indexOf("++")>0){var E=y[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),S=y[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");C=X.symbol.indexOf(E),O=X.symbol.indexOf(S)}-1===C&&(C=0),-1===O&&(O=0),X.first&&(X.first.length>C&&(T.firstX=X.first[C]),X.first.length>O&&(T.firstY=X.first[O])),X.last&&(X.last.length>C&&(T.lastX=X.last[C]),X.last.length>O&&(T.lastY=X.last[O])),X.vardim&&X.vardim.length>C&&(T.nbPoints=X.vardim[C]),X.factor&&(X.factor.length>C&&(T.xFactor=X.factor[C]),X.factor.length>O&&(T.yFactor=X.factor[O])),X.units&&(X.units.length>C&&(T.xUnit=X.units[C]),X.units.length>O&&(T.yUnit=X.units[O])),T.datatable=y[0],y[1]&&y[1].indexOf("PEAKS")>-1?c="PEAKTABLE":y[1]&&(y[1].indexOf("XYDATA")||y[0].indexOf("++")>0)&&(c="XYDATA",T.deltaX=(T.lastX-T.firstX)/(T.nbPoints-1))}if("TITLE"===c)T.title=g;else if("DATATYPE"===c)T.dataType=g,g.indexOf("nD")>-1&&(A.twoD=!0);else if("XUNITS"===c)T.xUnit=g;else if("YUNITS"===c)T.yUnit=g;else if("FIRSTX"===c)T.firstX=parseFloat(g);else if("LASTX"===c)T.lastX=parseFloat(g);else if("FIRSTY"===c)T.firstY=parseFloat(g);else if("NPOINTS"===c)T.nbPoints=parseFloat(g);else if("XFACTOR"===c)T.xFactor=parseFloat(g);else if("YFACTOR"===c)T.yFactor=parseFloat(g);else if("DELTAX"===c)T.deltaX=parseFloat(g);else if(".OBSERVEFREQUENCY"===c||"$SFO1"===c)T.observeFrequency||(T.observeFrequency=parseFloat(g));else if(".OBSERVENUCLEUS"===c)T.xType||(A.xType=g.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===c)A.indirectFrequency||(A.indirectFrequency=parseFloat(g));else if("$OFFSET"===c)A.shiftOffsetNum=0,A.shiftOffsetVal||(A.shiftOffsetVal=parseFloat(g));else if("$REFERENCEPOINT"===c);else if("VARNAME"===c)X.varname=g.split(/[, \t]{2,}/);else if("SYMBOL"===c)X.symbol=g.split(/[, \t]{2,}/);else if("VARTYPE"===c)X.vartype=g.split(/[, \t]{2,}/);else if("VARFORM"===c)X.varform=g.split(/[, \t]{2,}/);else if("VARDIM"===c)X.vardim=e(g.split(/[, \t]{2,}/));else if("UNITS"===c)X.units=g.split(/[, \t]{2,}/);else if("FACTOR"===c)X.factor=e(g.split(/[, \t]{2,}/));else if("FIRST"===c)X.first=e(g.split(/[, \t]{2,}/));else if("LAST"===c)X.last=e(g.split(/[, \t]{2,}/));else if("MIN"===c)X.min=e(g.split(/[, \t]{2,}/));else if("MAX"===c)X.max=e(g.split(/[, \t]{2,}/));else if(".NUCLEUS"===c)A.twoD&&(A.yType=g.split(/[, \t]{2,}/)[0]);else if("PAGE"===c){T.page=g.trim(),T.pageValue=parseFloat(g.replace(/^.*=/,"")),T.pageSymbol=T.page.replace(/=.*/,"");var R=X.symbol.indexOf(T.pageSymbol),Y="";X.units&&X.units[R]&&(Y=X.units[R]),A.indirectFrequency&&"PPM"!==Y&&(T.pageValue/=A.indirectFrequency)}else"RETENTIONTIME"===c?T.pageValue=parseFloat(g):"XYDATA"===c?(n(A,T),g.match(/.*\+\+.*/)?o(T,g,A):s(T,g,A),b.push(T),T={}):"PEAKTABLE"===c?(n(A,T),s(T,g,A),b.push(T),T={}):r(c)&&(T[a(c)]=g);c.match(p)&&(A.info[c]=g.trim())}if(A.profiling&&A.profiling.push({action:"Finished parsing",time:new Date-x}),Object.keys(X).length>0){for(var U=[],D=Object.keys(X),d=0;d<D.length;d++)for(var P=D[d],w=X[P],L=0;L<w.length;L++)U[L]||(U[L]={}),U[L][P]=w[L];A.ntuples=U}if(A.twoD&&(f(A),A.profiling&&A.profiling.push({action:"Finished countour plot calculation",time:new Date-x}),l.keepSpectra||delete A.spectra),b.length>1&&(!b[0].dataType||b[0].dataType.toLowerCase().match(/.*mass./))&&(i(A),A.profiling&&A.profiling.push({action:"Finished GCMS calculation",time:new Date-x})),l.xy&&b.length>0)for(var d=0;d<b.length;d++){var T=b[d];if(T.data.length>0)for(var L=0;L<T.data.length;L++){for(var M=T.data[L],N={x:Array(M.length/2),y:Array(M.length/2)},V=0;V<M.length;V+=2)N.x[V/2]=M[V],N.y[V/2]=M[V+1];T.data[L]=N}}return A.profiling&&A.profiling.push({action:"Total time",time:new Date-x}),A}function a(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function r(e){for(var t=0;t<d.length;t++)if(e===d[t])return!0;return!1}function i(e){var t,r=e.spectra,i=[];for(t=0;t<d.length;t++){var n=a(d[t]);r[0][n]&&i.push(n)}if(0!==i.length){var s={};for(s.gc={},s.ms=[],t=0;t<i.length;t++)s.gc[i[t]]=[];for(t=0;t<r.length;t++){for(var o=r[t],l=0;l<i.length;l++)s.gc[i[l]].push(o.pageValue),s.gc[i[l]].push(parseFloat(o[i[l]]));o.data&&(s.ms[t]=o.data[0])}e.gcms=s}}function n(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var a=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-a,t.lastX=t.lastX-a}}function s(e,t,a){e.isPeaktable=!0;var r,i,n,s,o,l=[];e.data=[l];var f=t.split(/,? *,?[;\r\n]+ */),p=0;for(r=1,i=f.length;i>r;r++)if(o=f[r].trim().replace(c,"").split(g),o.length%2===0)for(n=0,s=o.length;s>n;n+=2)l[p++]=parseFloat(o[n])*e.xFactor,l[p++]=parseFloat(o[n+1])*e.yFactor;else a.logs.push("Format error: "+o)}function o(e,t,a){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1)),e.isXYdata=!0;var r=[];e.data=[r];var i,n,s,o=e.firstX,l=e.firstY,f=t.split(/[\r\n]+/);n=[];for(var p=1,g=f.length;g>p;p++)if(n=f[p].trim().replace(c,"").split(u),n.length>0){if(h){e.firstPoint||(e.firstPoint=parseFloat(n[0]));var d=parseFloat(n[0]-e.firstPoint)*e.xFactor+e.firstX;(i||0===i)&&(d+=e.deltaX),a.logs.push("Checking X value: currentX: "+o+" - expectedCurrentX: "+d)}for(var v=1,m=n.length;m>v;v++)if(1!==v||!i&&0!==i){if(n[v].length>0)if(s=n[v].charCodeAt(0),43===s||45===s||46===s||s>47&&58>s)i=null,l=parseFloat(n[v]),r.push(o,l*e.yFactor),o+=e.deltaX;else if(s>63&&74>s)i=null,l=parseFloat(String.fromCharCode(s-16)+n[v].substring(1)),r.push(o,l*e.yFactor),o+=e.deltaX;else if(s>96&&106>s)i=null,l=-parseFloat(String.fromCharCode(s-48)+n[v].substring(1)),r.push(o,l*e.yFactor),o+=e.deltaX;else if(s>82&&91>s||115===s){var F=parseFloat(String.fromCharCode(s-34)+n[v].substring(1))-1;115===s&&(F=parseFloat("9"+n[v].substring(1))-1);for(var y=0;F>y;y++)i&&(l+=i),r.push(o,l*e.yFactor),o+=e.deltaX}else 37===s?(i=parseFloat("0"+n[v].substring(1)),l+=i,r.push(o,l*e.yFactor),o+=e.deltaX):s>73&&83>s?(i=parseFloat(String.fromCharCode(s-25)+n[v].substring(1)),l+=i,r.push(o,l*e.yFactor),o+=e.deltaX):s>105&&115>s&&(i=-parseFloat(String.fromCharCode(s-57)+n[v].substring(1)),l+=i,r.push(o,l*e.yFactor),o+=e.deltaX)}else i=null,s=n[v].charCodeAt(0)}}function l(e){for(var t=0,a=e[0].data[0][0],r=a,i=e.length,n=e[0].data[0].length/2,s=new Array(i),o=0;i>o;o++){s[o]=new Array(n);for(var l=0;n>l;l++)s[o][l]=e[o].data[0][2*l+1],s[o][l]<a&&(a=e[o].data[0][2*l+1]),s[o][l]>r&&(r=e[o].data[0][2*l+1]),0!==o&&0!==l&&(t+=Math.abs(s[o][l]-s[o][l-1])+Math.abs(s[o][l]-s[o-1][l]))}return{z:s,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[i-1].pageValue,minZ:a,maxZ:r,noise:t/((i-1)*(n-1)*2)}}function f(e){var t=l(e.spectra);e.contourLines=p(t),delete t.z,e.minMax=t}function p(e,t){for(var a,r,i,n,s,o=e.noise,l=e.z,f=[],p=7,u=new Float32Array(4),c=[],g=l.length,h=l[0].length,d=e.minX,v=e.maxX,m=(v-d)/(h-1),F=e.minY,y=e.maxY,x=(y-F)/(g-1),X=e.minZ,A=e.maxZ,b=0;2*p>b;b++){var T={};f.push(T);var C=b%2;s=0===C?(A-5*o)*Math.exp(b/2-p)+5*o:-(A-5*o)*Math.exp(b/2-p)-5*o;var O=[];if(T.zValue=s,T.lines=O,!(X>=s||s>=A))for(var E=0;g-1>E;E++)for(var S=0;h-1>S;S++){u[0]=l[E][S],u[1]=l[E][S+1],u[2]=l[E+1][S],u[3]=l[E+1][S+1];for(var R=0;4>R;R++)c[R]=u[R]>s;c[0]!==c[1]&&c[0]!==c[2]&&(a=S+(s-u[0])/(u[1]-u[0]),r=E,i=S,n=E+(s-u[0])/(u[2]-u[0]),O.push(a*m+d,r*x+F,i*m+d,n*x+F)),c[3]!==c[1]&&c[3]!==c[2]&&(a=S+1,r=E+1-(s-u[3])/(u[1]-u[3]),i=S+1-(s-u[3])/(u[2]-u[3]),n=E+1,O.push(a*m+d,r*x+F,i*m+d,n*x+F)),c[1]!==c[2]&&(a=S+1-(s-u[1])/(u[2]-u[1]),r=E+(s-u[1])/(u[2]-u[1]),c[1]!==c[0]&&(i=S+1-(s-u[1])/(u[0]-u[1]),n=E,O.push(a*m+d,r*x+F,i*m+d,n*x+F)),c[2]!==c[0]&&(i=S,n=E+1-(s-u[2])/(u[0]-u[2]),O.push(a*m+d,r*x+F,i*m+d,n*x+F)),c[1]!==c[3]&&(i=S+1,n=E+(s-u[1])/(u[3]-u[1]),O.push(a*m+d,r*x+F,i*m+d,n*x+F)),c[2]!==c[3]&&(i=S+(s-u[2])/(u[3]-u[2]),n=E+1,O.push(a*m+d,r*x+F,i*m+d,n*x+F)))}}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:f}}var u=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,c=/\$\$.*/,g=/[,\t ]+/,h=!1,d=["TIC",".RIC","SCANNUMBER"];return t}function r(e,t,a){return"boolean"==typeof t&&(a=t,t={}),a?i(e,t):o(e,t)}function i(e,t){return s||n(),new Promise(function(a){var r=Date.now()+""+Math.random();l[r]=a,s.postMessage({stamp:r,input:e,options:t})})}function n(){var e=URL.createObjectURL(new Blob(["var getConverter ="+a.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));s=new Worker(e),URL.revokeObjectURL(e),s.addEventListener("message",function(e){var t=e.data.stamp;l[t]&&l[t](e.data.output)})}var s,o=a(),l={};e.exports={convert:r}}])});
//# sourceMappingURL=jcampconverter.min.js.map