!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JcampConverter=t():e.JcampConverter=t()}(this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var i=a[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t){"use strict";function a(){function e(e){for(var t=e.length,a=new Array(t),r=0;t>r;r++)a[r]=parseFloat(e[r]);return a}function t(t,l){l=l||{};var p=/^$/;l.keepRecordsRegExp&&(p=l.keepRecordsRegExp);var u,c,g,d,v,m,F,x,y,X=new Date,A={},b={};b.profiling=[],b.logs=[];var T=[];b.spectra=T,b.info={};var O={};if("string"!=typeof t)return b;for(b.profiling&&b.profiling.push({action:"Before split to LDRS",time:new Date-X}),d=t.split(/[\r\n]+##/),b.profiling&&b.profiling.push({action:"Split to LDRS",time:new Date-X}),d[0]&&(d[0]=d[0].replace(/^[\r\n ]*##/,"")),v=0,m=d.length;m>v;v++){if(u=d[v],F=u.indexOf("="),F>0?(c=u.substring(0,F),g=u.substring(F+1).trim()):(c=u,g=""),c=c.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===c&&(x=g.indexOf("\n"),-1===x&&(x=g.indexOf("\r")),x>0)){var S=-1,E=-1;if(y=g.substring(0,x).split(/[ ,;\t]+/),y[0].indexOf("++")>0){var C=y[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),R=y[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");S=A.symbol.indexOf(C),E=A.symbol.indexOf(R)}-1===S&&(S=0),-1===E&&(E=0),A.first&&(A.first.length>S&&(O.firstX=A.first[S]),A.first.length>E&&(O.firstY=A.first[E])),A.last&&(A.last.length>S&&(O.lastX=A.last[S]),A.last.length>E&&(O.lastY=A.last[E])),A.vardim&&A.vardim.length>S&&(O.nbPoints=A.vardim[S]),A.factor&&(A.factor.length>S&&(O.xFactor=A.factor[S]),A.factor.length>E&&(O.yFactor=A.factor[E])),A.units&&(A.units.length>S&&(O.xUnit=A.units[S]),A.units.length>E&&(O.yUnit=A.units[E])),O.datatable=y[0],y[1]&&y[1].indexOf("PEAKS")>-1?c="PEAKTABLE":y[1]&&(y[1].indexOf("XYDATA")||y[0].indexOf("++")>0)&&(c="XYDATA",O.deltaX=(O.lastX-O.firstX)/(O.nbPoints-1))}if("TITLE"===c)O.title=g;else if("DATATYPE"===c)O.dataType=g,g.indexOf("nD")>-1&&(b.twoD=!0);else if("NTUPLES"===c)g.indexOf("nD")>-1&&(b.twoD=!0);else if("XUNITS"===c)O.xUnit=g;else if("YUNITS"===c)O.yUnit=g;else if("FIRSTX"===c)O.firstX=parseFloat(g);else if("LASTX"===c)O.lastX=parseFloat(g);else if("FIRSTY"===c)O.firstY=parseFloat(g);else if("LASTY"===c)O.lastY=parseFloat(g);else if("NPOINTS"===c)O.nbPoints=parseFloat(g);else if("XFACTOR"===c)O.xFactor=parseFloat(g);else if("YFACTOR"===c)O.yFactor=parseFloat(g);else if("DELTAX"===c)O.deltaX=parseFloat(g);else if(".OBSERVEFREQUENCY"===c||"$SFO1"===c)O.observeFrequency||(O.observeFrequency=parseFloat(g));else if(".OBSERVENUCLEUS"===c)O.xType||(b.xType=g.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===c)b.indirectFrequency||(b.indirectFrequency=parseFloat(g));else if("$OFFSET"===c)b.shiftOffsetNum=0,b.shiftOffsetVal||(b.shiftOffsetVal=parseFloat(g));else if("$REFERENCEPOINT"===c);else if("VARNAME"===c)A.varname=g.split(h);else if("SYMBOL"===c)A.symbol=g.split(h);else if("VARTYPE"===c)A.vartype=g.split(h);else if("VARFORM"===c)A.varform=g.split(h);else if("VARDIM"===c)A.vardim=e(g.split(h));else if("UNITS"===c)A.units=g.split(h);else if("FACTOR"===c)A.factor=e(g.split(h));else if("FIRST"===c)A.first=e(g.split(h));else if("LAST"===c)A.last=e(g.split(h));else if("MIN"===c)A.min=e(g.split(h));else if("MAX"===c)A.max=e(g.split(h));else if(".NUCLEUS"===c)b.twoD&&(b.yType=g.split(h)[0]);else if("PAGE"===c){O.page=g.trim(),O.pageValue=parseFloat(g.replace(/^.*=/,"")),O.pageSymbol=O.page.replace(/=.*/,"");var Y=A.symbol.indexOf(O.pageSymbol),D="";A.units&&A.units[Y]&&(D=A.units[Y]),b.indirectFrequency&&"PPM"!==D&&(O.pageValue/=b.indirectFrequency)}else"RETENTIONTIME"===c?O.pageValue=parseFloat(g):"XYDATA"===c?(n(b,O),g.match(/.*\+\+.*/)?o(O,g,b):s(O,g,b),T.push(O),O={}):"PEAKTABLE"===c?(n(b,O),s(O,g,b),T.push(O),O={}):r(c)&&(O[a(c)]=g);c.match(p)&&(b.info[c]=g.trim())}if(b.profiling&&b.profiling.push({action:"Finished parsing",time:new Date-X}),Object.keys(A).length>0){for(var U=[],P=Object.keys(A),v=0;v<P.length;v++)for(var L=P[v],w=A[L],M=0;M<w.length;M++)U[M]||(U[M]={}),U[M][L]=w[M];b.ntuples=U}if(b.twoD&&(f(b),b.profiling&&b.profiling.push({action:"Finished countour plot calculation",time:new Date-X}),l.keepSpectra||delete b.spectra),T.length>1&&(!T[0].dataType||T[0].dataType.match(/.*mass.*/i))&&(i(b),b.profiling&&b.profiling.push({action:"Finished GCMS calculation",time:new Date-X})),l.xy&&T.length>0)for(var v=0;v<T.length;v++){var O=T[v];if(O.data.length>0)for(var M=0;M<O.data.length;M++){for(var N=O.data[M],V={x:Array(N.length/2),y:Array(N.length/2)},I=0;I<N.length;I+=2)V.x[I/2]=N[I],V.y[I/2]=N[I+1];O.data[M]=V}}return b.profiling&&b.profiling.push({action:"Total time",time:new Date-X}),b}function a(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function r(e){for(var t=0;t<v.length;t++)if(e===v[t])return!0;return!1}function i(e){var t,r=e.spectra,i=[];for(t=0;t<v.length;t++){var n=a(v[t]);r[0][n]&&i.push(n)}if(0!==i.length){var s={};for(s.gc={},s.ms=[],t=0;t<i.length;t++)s.gc[i[t]]=[];for(t=0;t<r.length;t++){for(var o=r[t],l=0;l<i.length;l++)s.gc[i[l]].push(o.pageValue),s.gc[i[l]].push(parseFloat(o[i[l]]));o.data&&(s.ms[t]=o.data[0])}e.gcms=s}}function n(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var a=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-a,t.lastX=t.lastX-a}}function s(e,t,a){e.isPeaktable=!0;var r,i,n,s,o,l=[];e.data=[l];var f=t.split(/,? *,?[;\r\n]+ */),p=0;for(r=1,i=f.length;i>r;r++)if(o=f[r].trim().replace(c,"").split(g),o.length%2===0)for(n=0,s=o.length;s>n;n+=2)l[p++]=parseFloat(o[n])*e.xFactor,l[p++]=parseFloat(o[n+1])*e.yFactor;else a.logs.push("Format error: "+o)}function o(e,t,a){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1)),e.isXYdata=!0;var r=[];e.data=[r];var i,n,s,o=e.firstX,l=e.firstY,f=t.split(/[\r\n]+/);n=[];for(var p=1,g=f.length;g>p;p++)if(n=f[p].trim().replace(c,"").split(u),n.length>0){if(d){e.firstPoint||(e.firstPoint=parseFloat(n[0]));var h=parseFloat(n[0]-e.firstPoint)*e.xFactor+e.firstX;(i||0===i)&&(h+=e.deltaX),a.logs.push("Checking X value: currentX: "+o+" - expectedCurrentX: "+h)}for(var v=1,m=n.length;m>v;v++)if(1!==v||!i&&0!==i){if(n[v].length>0)if(s=n[v].charCodeAt(0),43===s||45===s||46===s||s>47&&58>s)i=null,l=parseFloat(n[v]),r.push(o,l*e.yFactor),o+=e.deltaX;else if(s>63&&74>s)i=null,l=parseFloat(String.fromCharCode(s-16)+n[v].substring(1)),r.push(o,l*e.yFactor),o+=e.deltaX;else if(s>96&&106>s)i=null,l=-parseFloat(String.fromCharCode(s-48)+n[v].substring(1)),r.push(o,l*e.yFactor),o+=e.deltaX;else if(s>82&&91>s||115===s){var F=parseFloat(String.fromCharCode(s-34)+n[v].substring(1))-1;115===s&&(F=parseFloat("9"+n[v].substring(1))-1);for(var x=0;F>x;x++)i&&(l+=i),r.push(o,l*e.yFactor),o+=e.deltaX}else 37===s?(i=parseFloat("0"+n[v].substring(1)),l+=i,r.push(o,l*e.yFactor),o+=e.deltaX):s>73&&83>s?(i=parseFloat(String.fromCharCode(s-25)+n[v].substring(1)),l+=i,r.push(o,l*e.yFactor),o+=e.deltaX):s>105&&115>s&&(i=-parseFloat(String.fromCharCode(s-57)+n[v].substring(1)),l+=i,r.push(o,l*e.yFactor),o+=e.deltaX)}else i=null,s=n[v].charCodeAt(0)}}function l(e){for(var t=0,a=e[0].data[0][0],r=a,i=e.length,n=e[0].data[0].length/2,s=new Array(i),o=0;i>o;o++){s[o]=new Array(n);for(var l=0;n>l;l++)s[o][l]=e[o].data[0][2*l+1],s[o][l]<a&&(a=e[o].data[0][2*l+1]),s[o][l]>r&&(r=e[o].data[0][2*l+1]),0!==o&&0!==l&&(t+=Math.abs(s[o][l]-s[o][l-1])+Math.abs(s[o][l]-s[o-1][l]))}return{z:s,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[i-1].pageValue,minZ:a,maxZ:r,noise:t/((i-1)*(n-1)*2)}}function f(e){var t=l(e.spectra);e.contourLines=p(t),delete t.z,e.minMax=t}function p(e,t){for(var a,r,i,n,s,o=e.noise,l=e.z,f=[],p=7,u=new Float32Array(4),c=[],g=l.length,h=l[0].length,d=e.minX,v=e.maxX,m=(v-d)/(h-1),F=e.minY,x=e.maxY,y=(x-F)/(g-1),X=e.minZ,A=e.maxZ,b=0;2*p>b;b++){var T={};f.push(T);var O=b%2;s=0===O?(A-5*o)*Math.exp(b/2-p)+5*o:-(A-5*o)*Math.exp(b/2-p)-5*o;var S=[];if(T.zValue=s,T.lines=S,!(X>=s||s>=A))for(var E=0;g-1>E;E++)for(var C=0;h-1>C;C++){u[0]=l[E][C],u[1]=l[E][C+1],u[2]=l[E+1][C],u[3]=l[E+1][C+1];for(var R=0;4>R;R++)c[R]=u[R]>s;c[0]!==c[1]&&c[0]!==c[2]&&(a=C+(s-u[0])/(u[1]-u[0]),r=E,i=C,n=E+(s-u[0])/(u[2]-u[0]),S.push(a*m+d,r*y+F,i*m+d,n*y+F)),c[3]!==c[1]&&c[3]!==c[2]&&(a=C+1,r=E+1-(s-u[3])/(u[1]-u[3]),i=C+1-(s-u[3])/(u[2]-u[3]),n=E+1,S.push(a*m+d,r*y+F,i*m+d,n*y+F)),c[1]!==c[2]&&(a=C+1-(s-u[1])/(u[2]-u[1]),r=E+(s-u[1])/(u[2]-u[1]),c[1]!==c[0]&&(i=C+1-(s-u[1])/(u[0]-u[1]),n=E,S.push(a*m+d,r*y+F,i*m+d,n*y+F)),c[2]!==c[0]&&(i=C,n=E+1-(s-u[2])/(u[0]-u[2]),S.push(a*m+d,r*y+F,i*m+d,n*y+F)),c[1]!==c[3]&&(i=C+1,n=E+(s-u[1])/(u[3]-u[1]),S.push(a*m+d,r*y+F,i*m+d,n*y+F)),c[2]!==c[3]&&(i=C+(s-u[2])/(u[3]-u[2]),n=E+1,S.push(a*m+d,r*y+F,i*m+d,n*y+F)))}}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:f}}var u=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,c=/\$\$.*/,g=/[,\t ]+/,h=/[, \t]{1,}/,d=!1,v=["TIC",".RIC","SCANNUMBER"];return t}function r(e,t,a){return"boolean"==typeof t&&(a=t,t={}),a?i(e,t):o(e,t)}function i(e,t){return s||n(),new Promise(function(a){var r=Date.now()+""+Math.random();l[r]=a,s.postMessage({stamp:r,input:e,options:t})})}function n(){var e=URL.createObjectURL(new Blob(["var getConverter ="+a.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));s=new Worker(e),URL.revokeObjectURL(e),s.addEventListener("message",function(e){var t=e.data.stamp;l[t]&&l[t](e.data.output)})}var s,o=a(),l={};e.exports={convert:r}}])});
//# sourceMappingURL=jcampconverter.min.js.map