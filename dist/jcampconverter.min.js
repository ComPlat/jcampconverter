!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JcampConverter=t():e.JcampConverter=t()}(this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var i=a[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";function r(){function e(e){for(var t=e.length,a=new Array(t),r=0;t>r;r++)a[r]=parseFloat(e[r]);return a}function t(t,o){o=o||{};var p=/^$/;o.keepRecordsRegExp&&(p=o.keepRecordsRegExp);var g,d,v,m,F,y,x,X,A,b=Date.now(),T={},C={};C.profiling=[],C.logs=[];var S=[];C.spectra=S,C.info={};var O={};if("string"!=typeof t)return C;for(C.profiling&&C.profiling.push({action:"Before split to LDRS",time:Date.now()-b}),m=t.split(/[\r\n]+##/),C.profiling&&C.profiling.push({action:"Split to LDRS",time:Date.now()-b}),m[0]&&(m[0]=m[0].replace(/^[\r\n ]*##/,"")),F=0,y=m.length;y>F;F++){if(g=m[F],x=g.indexOf("="),x>0?(d=g.substring(0,x),v=g.substring(x+1).trim()):(d=g,v=""),d=d.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===d&&(X=v.indexOf("\n"),-1===X&&(X=v.indexOf("\r")),X>0)){var E=-1,R=-1;if(A=v.substring(0,X).split(/[ ,;\t]+/),A[0].indexOf("++")>0){var w=A[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),Y=A[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");E=T.symbol.indexOf(w),R=T.symbol.indexOf(Y)}-1===E&&(E=0),-1===R&&(R=0),T.first&&(T.first.length>E&&(O.firstX=T.first[E]),T.first.length>R&&(O.firstY=T.first[R])),T.last&&(T.last.length>E&&(O.lastX=T.last[E]),T.last.length>R&&(O.lastY=T.last[R])),T.vardim&&T.vardim.length>E&&(O.nbPoints=T.vardim[E]),T.factor&&(T.factor.length>E&&(O.xFactor=T.factor[E]),T.factor.length>R&&(O.yFactor=T.factor[R])),T.units&&(T.units.length>E&&(O.xUnit=T.units[E]),T.units.length>R&&(O.yUnit=T.units[R])),O.datatable=A[0],A[1]&&A[1].indexOf("PEAKS")>-1?d="PEAKTABLE":A[1]&&(A[1].indexOf("XYDATA")||A[0].indexOf("++")>0)&&(d="XYDATA",O.deltaX=(O.lastX-O.firstX)/(O.nbPoints-1))}if("TITLE"===d)O.title=v;else if("DATATYPE"===d)O.dataType=v,v.indexOf("nD")>-1&&(C.twoD=!0);else if("NTUPLES"===d)v.indexOf("nD")>-1&&(C.twoD=!0);else if("XUNITS"===d)O.xUnit=v;else if("YUNITS"===d)O.yUnit=v;else if("FIRSTX"===d)O.firstX=parseFloat(v);else if("LASTX"===d)O.lastX=parseFloat(v);else if("FIRSTY"===d)O.firstY=parseFloat(v);else if("LASTY"===d)O.lastY=parseFloat(v);else if("NPOINTS"===d)O.nbPoints=parseFloat(v);else if("XFACTOR"===d)O.xFactor=parseFloat(v);else if("YFACTOR"===d)O.yFactor=parseFloat(v);else if("DELTAX"===d)O.deltaX=parseFloat(v);else if(".OBSERVEFREQUENCY"===d||"$SFO1"===d)O.observeFrequency||(O.observeFrequency=parseFloat(v));else if(".OBSERVENUCLEUS"===d)O.xType||(C.xType=v.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===d)C.indirectFrequency||(C.indirectFrequency=parseFloat(v));else if("$OFFSET"===d)C.shiftOffsetNum=0,C.shiftOffsetVal||(C.shiftOffsetVal=parseFloat(v));else if("$REFERENCEPOINT"===d);else if("VARNAME"===d)T.varname=v.split(h);else if("SYMBOL"===d)T.symbol=v.split(h);else if("VARTYPE"===d)T.vartype=v.split(h);else if("VARFORM"===d)T.varform=v.split(h);else if("VARDIM"===d)T.vardim=e(v.split(h));else if("UNITS"===d)T.units=v.split(h);else if("FACTOR"===d)T.factor=e(v.split(h));else if("FIRST"===d)T.first=e(v.split(h));else if("LAST"===d)T.last=e(v.split(h));else if("MIN"===d)T.min=e(v.split(h));else if("MAX"===d)T.max=e(v.split(h));else if(".NUCLEUS"===d)C.twoD&&(C.yType=v.split(h)[0]);else if("PAGE"===d){O.page=v.trim(),O.pageValue=parseFloat(v.replace(/^.*=/,"")),O.pageSymbol=O.page.replace(/=.*/,"");var P=T.symbol.indexOf(O.pageSymbol),D="";T.units&&T.units[P]&&(D=T.units[P]),C.indirectFrequency&&"PPM"!==D&&(O.pageValue/=C.indirectFrequency)}else"RETENTIONTIME"===d?O.pageValue=parseFloat(v):"XYDATA"===d?(n(C,O),v.match(/.*\+\+.*/)?o.fastParse===!1?l(O,v,C):(O.deltaX||(O.deltaX=(O.lastX-O.firstX)/(O.nbPoints-1)),u(O,v,C)):c(O,v,C),S.push(O),O={}):"PEAKTABLE"===d?(n(C,O),c(O,v,C),S.push(O),O={}):r(d)&&(O[a(d)]=v);d.match(p)&&(C.info[d]=v.trim())}if(C.profiling&&C.profiling.push({action:"Finished parsing",time:Date.now()-b}),Object.keys(T).length>0){for(var U=[],M=Object.keys(T),F=0;F<M.length;F++)for(var L=M[F],N=T[L],V=0;V<N.length;V++)U[V]||(U[V]={}),U[V][L]=N[V];C.ntuples=U}C.twoD&&(f(C),C.profiling&&C.profiling.push({action:"Finished countour plot calculation",time:Date.now()-b}),o.keepSpectra||delete C.spectra);var I=S.length>1&&(!S[0].dataType||S[0].dataType.match(/.*mass.*/i));if(I&&o.newGCMS&&(o.xy=!0),o.xy&&S.length>0)for(var F=0;F<S.length;F++){var O=S[F];if(O.data.length>0)for(var V=0;V<O.data.length;V++){for(var q=O.data[V],$={x:new Array(q.length/2),y:new Array(q.length/2)},k=0;k<q.length;k+=2)$.x[k/2]=q[k],$.y[k/2]=q[k+1];O.data[V]=$}}return I&&(o.newGCMS?i(C):s(C),C.profiling&&C.profiling.push({action:"Finished GCMS calculation",time:Date.now()-b})),C.profiling&&C.profiling.push({action:"Total time",time:Date.now()-b}),C}function a(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function r(e){return-1!==g.indexOf(e)}function i(e){var t,r=e.spectra,i=r.length,s={times:new Array(i),series:[{name:"ms",dimension:2,data:new Array(i)}]},n=[];for(t=0;t<g.length;t++){var o=a(g[t]);r[0][o]&&(n.push(o),s.series.push({name:o,dimension:1,data:new Array(i)}))}for(t=0;i>t;t++){var l=r[t];s.times[t]=l.pageValue;for(var f=0;f<n.length;f++)s.series[f+1].data[t]=parseFloat(l[n[f]]);l.data&&(s.series[0].data[t]=[l.data[0].x,l.data[0].y])}e.gcms=s}function s(e){var t,r=e.spectra,i=[];for(t=0;t<g.length;t++){var s=a(g[t]);r[0][s]&&i.push(s)}if(0!==i.length){var n={};for(n.gc={},n.ms=[],t=0;t<i.length;t++)n.gc[i[t]]=[];for(t=0;t<r.length;t++){for(var o=r[t],l=0;l<i.length;l++)n.gc[i[l]].push(o.pageValue),n.gc[i[l]].push(parseFloat(o[i[l]]));o.data&&(n.ms[t]=o.data[0])}e.gcms=n}}function n(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var a=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-a,t.lastX=t.lastX-a}}function o(e){for(var t=0,a=e[0].data[0][0],r=a,i=e.length,s=e[0].data[0].length/2,n=new Array(i),o=0;i>o;o++){n[o]=new Array(s);for(var l=e[o].data[0],f=0;s>f;f++){var p=l[2*f+1];n[o][f]=p,a>p&&(a=p),p>r&&(r=p),0!==o&&0!==f&&(t+=Math.abs(p-n[o][f-1])+Math.abs(p-n[o-1][f]))}}return{z:n,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[i-1].pageValue,minZ:a,maxZ:r,noise:t/((i-1)*(s-1)*2)}}function f(e){var t=o(e.spectra);e.contourLines=p(t),delete t.z,e.minMax=t}function p(e,t){for(var a,r,i,s,n,o,l,f,p,u,c,h,g,d=e.noise,v=e.z,m=[],F=7,y=v.length,x=v[0].length,X=e.minX,A=e.maxX,b=(A-X)/(x-1),T=e.minY,C=e.maxY,S=(C-T)/(y-1),O=e.minZ,E=e.maxZ,R=0;2*F>R;R++){var w={};m[R]=w;var Y=R%2;g=0===Y?(E-5*d)*Math.exp(R/2-F)+5*d:-(E-5*d)*Math.exp(R/2-F)-5*d;var P=[];if(w.zValue=g,w.lines=P,!(O>=g||g>=E))for(var D=0;y-1>D;D++)for(var U=v[D],M=v[D+1],L=0;x-1>L;L++)a=U[L],r=U[L+1],i=M[L],s=M[L+1],n=a>g,o=r>g,l=i>g,f=s>g,n!==o&&n!==l&&(p=L+(g-a)/(r-a),u=D,c=L,h=D+(g-a)/(i-a),P.push(p*b+X),P.push(u*S+T),P.push(c*b+X),P.push(h*S+T)),f!==o&&f!==l&&(p=L+1,u=D+1-(g-s)/(r-s),c=L+1-(g-s)/(i-s),h=D+1,P.push(p*b+X),P.push(u*S+T),P.push(c*b+X),P.push(h*S+T)),o!==l&&(p=(L+1-(g-r)/(i-r))*b+X,u=(D+(g-r)/(i-r))*S+T,o!==n&&(c=L+1-(g-r)/(a-r),h=D,P.push(p),P.push(u),P.push(c*b+X),P.push(h*S+T)),l!==n&&(c=L,h=D+1-(g-i)/(a-i),P.push(p),P.push(u),P.push(c*b+X),P.push(h*S+T)),o!==f&&(c=L+1,h=D+(g-r)/(s-r),P.push(p),P.push(u),P.push(c*b+X),P.push(h*S+T)),l!==f&&(c=L+(g-i)/(s-i),h=D+1,P.push(p),P.push(u),P.push(c*b+X),P.push(h*S+T)))}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:m}}function u(e,t){var a=e.yFactor,r=e.deltaX;e.isXYdata=!0;var i=[],s=0;e.data=[i];for(var n=e.firstX,o=e.firstY,l=!1,f=0;f<t.length;f++){var p=t.charCodeAt(f);if(13===p||10===p)l=!0;else if(l)break}for(var p,u=!0,c=!1,h=!1,g=0,d=!1,v=!1,m=0,F=!1,y=!1,x=!1,X=0;f<=t.length;f++)if(p=f===t.length?13:t.charCodeAt(f),v)13!==p&&10!==p||(u=!0,v=!1);else if(57>=p&&p>=48)y=!0,X>0?m+=(p-48)/Math.pow(10,X++):(m*=10,m+=p-48);else if(44===p||46===p)y=!0,X++;else{if(y){if(u)u=!1,h&&(x=!0);else if(x)x=!1;else{c&&(g=0===m?0:F?-m:m,h=!0,c=!1);for(var A=d?m-1:1,b=0;A>b;b++)h?o+=g:o=0===m?0:F?-m:m,i[s++]=n,i[s++]=o*a,n+=r}F=!1,m=0,X=0,y=!1,d=!1}if(74>p&&p>63)y=!0,h=!1,m=p-64;else if(p>96&&106>p)y=!0,h=!1,m=p-96,F=!0;else if(115===p)y=!0,d=!0,m=9;else if(p>82&&91>p)y=!0,d=!0,m=p-82;else if(p>73&&83>p)y=!0,c=!0,m=p-73;else if(p>105&&115>p)y=!0,c=!0,m=p-105,F=!0;else if(36===p&&36===t.charCodeAt(f+1))y=!0,v=!0;else if(37===p)y=!0,c=!0,m=0,F=!1;else if(45===p){var T=t.charCodeAt(f+1);(T>=48&&57>=T||44===T||46===T)&&(y=!0,h=!1,F=!0)}else 13!==p&&10!==p||(u=!0,v=!1)}}function c(e,t,a){var r=/\$\$.*/,i=/[,\t ]+/;e.isPeaktable=!0;var s,n,o,l,f,p=[];e.data=[p];var u=t.split(/,? *,?[;\r\n]+ */),c=0;for(s=1,n=u.length;n>s;s++)if(f=u[s].trim().replace(r,"").split(i),f.length%2===0)for(o=0,l=f.length;l>o;o+=2)p[c++]=parseFloat(f[o])*e.xFactor,p[c++]=parseFloat(f[o+1])*e.yFactor;else a.logs.push("Format error: "+f)}var h=/[, \t]{1,}/,g=["TIC",".RIC","SCANNUMBER"];return t}function i(e,t,a){return"boolean"==typeof t&&(a=t,t={}),a?s(e,t):f(e,t)}function s(e,t){return o||n(),new Promise(function(a){var r=Date.now()+""+Math.random();p[r]=a,o.postMessage({stamp:r,input:e,options:t})})}function n(){var e=URL.createObjectURL(new Blob(["var getConverter ="+r.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));o=new Worker(e),URL.revokeObjectURL(e),o.addEventListener("message",function(e){var t=e.data.stamp;p[t]&&p[t](e.data.output)})}var o,l=a(1),f=r(),p={};e.exports={convert:i}},function(e,t){"use strict";var a=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,r=/\$\$.*/,i=!1;e.exports=function(e,t,s){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1)),e.isXYdata=!0;var n=[],o=0;e.data=[n];var l,f,p,u=e.firstX,c=e.firstY,h=t.split(/[\r\n]+/);f=[];for(var g=1,d=h.length;d>g;g++)if(f=h[g].trim().replace(r,"").split(a),f.length>0){if(i){e.firstPoint||(e.firstPoint=+f[0]);var v=(f[0]-e.firstPoint)*e.xFactor+e.firstX;(l||0===l)&&(v+=e.deltaX),s.logs.push("Checking X value: currentX: "+u+" - expectedCurrentX: "+v)}for(var m=1,F=f.length;F>m;m++)if(1!==m||!l&&0!==l){if(f[m].length>0)if(p=f[m].charCodeAt(0),43===p||45===p||46===p||p>47&&58>p)l=null,c=+f[m],n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>63&&74>p)l=null,c=+(String.fromCharCode(p-16)+f[m].substring(1)),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>96&&106>p)l=null,c=1*-(String.fromCharCode(p-48)+f[m].substring(1)),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>82&&91>p||115===p){var y=String.fromCharCode(p-34)+f[m].substring(1)-1;115===p&&(y="9"+f[m].substring(1)-1);for(var x=0;y>x;x++)l&&(c+=l),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX}else 37===p?(l=+("0"+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX):p>73&&83>p?(l=1*(String.fromCharCode(p-25)+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX):p>105&&115>p&&(l=1*-(String.fromCharCode(p-57)+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX)}else l=null,p=f[m].charCodeAt(0)}}}])});
//# sourceMappingURL=jcampconverter.min.js.map