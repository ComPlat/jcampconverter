!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JcampConverter=t():e.JcampConverter=t()}(this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var i=a[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";function r(){function e(e){for(var t=e.length,a=new Array(t),r=0;t>r;r++)a[r]=parseFloat(e[r]);return a}function t(){}function a(a,f){f=f||{};var u=/^$/;f.keepRecordsRegExp&&(u=f.keepRecordsRegExp);var d,v,m,F,y,X,x,A,b,S=Date.now(),T={},C={};C.profiling=[],C.logs=[];var O=[];C.spectra=O,C.info={};var E=new t;if("string"!=typeof a)return C;for(C.profiling&&C.profiling.push({action:"Before split to LDRS",time:Date.now()-S}),F=a.split(/[\r\n]+##/),C.profiling&&C.profiling.push({action:"Split to LDRS",time:Date.now()-S}),F[0]&&(F[0]=F[0].replace(/^[\r\n ]*##/,"")),y=0,X=F.length;X>y;y++){if(d=F[y],x=d.indexOf("="),x>0?(v=d.substring(0,x),m=d.substring(x+1).trim()):(v=d,m=""),v=v.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===v&&(A=m.indexOf("\n"),-1===A&&(A=m.indexOf("\r")),A>0)){var w=-1,R=-1;if(b=m.substring(0,A).split(/[ ,;\t]+/),b[0].indexOf("++")>0){var Y=b[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),P=b[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");w=T.symbol.indexOf(Y),R=T.symbol.indexOf(P)}-1===w&&(w=0),-1===R&&(R=0),T.first&&(T.first.length>w&&(E.firstX=T.first[w]),T.first.length>R&&(E.firstY=T.first[R])),T.last&&(T.last.length>w&&(E.lastX=T.last[w]),T.last.length>R&&(E.lastY=T.last[R])),T.vardim&&T.vardim.length>w&&(E.nbPoints=T.vardim[w]),T.factor&&(T.factor.length>w&&(E.xFactor=T.factor[w]),T.factor.length>R&&(E.yFactor=T.factor[R])),T.units&&(T.units.length>w&&(E.xUnit=T.units[w]),T.units.length>R&&(E.yUnit=T.units[R])),E.datatable=b[0],b[1]&&b[1].indexOf("PEAKS")>-1?v="PEAKTABLE":b[1]&&(b[1].indexOf("XYDATA")||b[0].indexOf("++")>0)&&(v="XYDATA",E.deltaX=(E.lastX-E.firstX)/(E.nbPoints-1))}if("TITLE"===v)E.title=m;else if("DATATYPE"===v)E.dataType=m,m.indexOf("nD")>-1&&(C.twoD=!0);else if("NTUPLES"===v)m.indexOf("nD")>-1&&(C.twoD=!0);else if("XUNITS"===v)E.xUnit=m;else if("YUNITS"===v)E.yUnit=m;else if("FIRSTX"===v)E.firstX=parseFloat(m);else if("LASTX"===v)E.lastX=parseFloat(m);else if("FIRSTY"===v)E.firstY=parseFloat(m);else if("LASTY"===v)E.lastY=parseFloat(m);else if("NPOINTS"===v)E.nbPoints=parseFloat(m);else if("XFACTOR"===v)E.xFactor=parseFloat(m);else if("YFACTOR"===v)E.yFactor=parseFloat(m);else if("DELTAX"===v)E.deltaX=parseFloat(m);else if(".OBSERVEFREQUENCY"===v||"$SFO1"===v)E.observeFrequency||(E.observeFrequency=parseFloat(m));else if(".OBSERVENUCLEUS"===v)E.xType||(C.xType=m.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===v)C.indirectFrequency||(C.indirectFrequency=parseFloat(m));else if("$OFFSET"===v)C.shiftOffsetNum=0,C.shiftOffsetVal||(C.shiftOffsetVal=parseFloat(m));else if("$REFERENCEPOINT"===v);else if("VARNAME"===v)T.varname=m.split(g);else if("SYMBOL"===v)T.symbol=m.split(g);else if("VARTYPE"===v)T.vartype=m.split(g);else if("VARFORM"===v)T.varform=m.split(g);else if("VARDIM"===v)T.vardim=e(m.split(g));else if("UNITS"===v)T.units=m.split(g);else if("FACTOR"===v)T.factor=e(m.split(g));else if("FIRST"===v)T.first=e(m.split(g));else if("LAST"===v)T.last=e(m.split(g));else if("MIN"===v)T.min=e(m.split(g));else if("MAX"===v)T.max=e(m.split(g));else if(".NUCLEUS"===v)C.twoD&&(C.yType=m.split(g)[0]);else if("PAGE"===v){E.page=m.trim(),E.pageValue=parseFloat(m.replace(/^.*=/,"")),E.pageSymbol=E.page.replace(/=.*/,"");var D=T.symbol.indexOf(E.pageSymbol),M="";T.units&&T.units[D]&&(M=T.units[D]),C.indirectFrequency&&"PPM"!==M&&(E.pageValue/=C.indirectFrequency)}else"RETENTIONTIME"===v?E.pageValue=parseFloat(m):"XYDATA"===v?(o(C,E),m.match(/.*\+\+.*/)?f.fastParse===!1?l(E,m,C):(E.deltaX||(E.deltaX=(E.lastX-E.firstX)/(E.nbPoints-1)),c(E,m,C)):h(E,m,C),O.push(E),E=new t):"PEAKTABLE"===v?(o(C,E),h(E,m,C),O.push(E),E=new t):i(v)&&(E[r(v)]=m);v.match(u)&&(C.info[v]=m.trim())}if(C.profiling&&C.profiling.push({action:"Finished parsing",time:Date.now()-S}),Object.keys(T).length>0){for(var U=[],L=Object.keys(T),y=0;y<L.length;y++)for(var N=L[y],V=T[N],I=0;I<V.length;I++)U[I]||(U[I]={}),U[I][N]=V[I];C.ntuples=U}C.twoD&&(p(C,f),C.profiling&&C.profiling.push({action:"Finished countour plot calculation",time:Date.now()-S}),f.keepSpectra||delete C.spectra);var q=O.length>1&&(!O[0].dataType||O[0].dataType.match(/.*mass.*/i));if(q&&f.newGCMS&&(f.xy=!0),f.xy&&O.length>0)for(var y=0;y<O.length;y++){var E=O[y];if(E.data.length>0)for(var I=0;I<E.data.length;I++){for(var $=E.data[I],k={x:new Array($.length/2),y:new Array($.length/2)},B=0;B<$.length;B+=2)k.x[B/2]=$[B],k.y[B/2]=$[B+1];E.data[I]=k}}return q&&(f.newGCMS?s(C):n(C),C.profiling&&C.profiling.push({action:"Finished GCMS calculation",time:Date.now()-S})),C.profiling&&C.profiling.push({action:"Total time",time:Date.now()-S}),C}function r(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function i(e){return-1!==d.indexOf(e)}function s(e){var t,a=e.spectra,i=a.length,s={times:new Array(i),series:[{name:"ms",dimension:2,data:new Array(i)}]},n=[];for(t=0;t<d.length;t++){var o=r(d[t]);a[0][o]&&(n.push(o),s.series.push({name:o,dimension:1,data:new Array(i)}))}for(t=0;i>t;t++){var l=a[t];s.times[t]=l.pageValue;for(var f=0;f<n.length;f++)s.series[f+1].data[t]=parseFloat(l[n[f]]);l.data&&(s.series[0].data[t]=[l.data[0].x,l.data[0].y])}e.gcms=s}function n(e){var t,a=e.spectra,i=[];for(t=0;t<d.length;t++){var s=r(d[t]);a[0][s]&&i.push(s)}if(0!==i.length){var n={};for(n.gc={},n.ms=[],t=0;t<i.length;t++)n.gc[i[t]]=[];for(t=0;t<a.length;t++){for(var o=a[t],l=0;l<i.length;l++)n.gc[i[l]].push(o.pageValue),n.gc[i[l]].push(parseFloat(o[i[l]]));o.data&&(n.ms[t]=o.data[0])}e.gcms=n}}function o(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var a=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-a,t.lastX=t.lastX-a}}function f(e){for(var t=0,a=e[0].data[0][0],r=a,i=e.length,s=e[0].data[0].length/2,n=new Array(i),o=0;i>o;o++){n[o]=new Array(s);for(var l=e[o].data[0],f=0;s>f;f++){var p=l[2*f+1];n[o][f]=p,a>p&&(a=p),p>r&&(r=p),0!==o&&0!==f&&(t+=Math.abs(p-n[o][f-1])+Math.abs(p-n[o-1][f]))}}return{z:n,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[i-1].pageValue,minZ:a,maxZ:r,noise:t/((i-1)*(s-1)*2)}}function p(e,t){var a=f(e.spectra);e.contourLines=u(a,t),delete a.z,e.minMax=a}function u(e,t){for(var a,r,i,s,n,o,l,f,p,u,c,h,g,d=e.noise,v=e.z,m=[],F=t.nbContourLevels||7,y=void 0===t.noiseMultiplier?5:t.noiseMultiplier,X=v.length,x=v[0].length,A=e.minX,b=e.maxX,S=(b-A)/(x-1),T=e.minY,C=e.maxY,O=(C-T)/(X-1),E=e.minZ,w=e.maxZ,R=0;2*F>R;R++){var Y={};m[R]=Y;var P=R%2,D=(w-y*d)*Math.exp(R>>1-F);g=0===P?D+y*d:-D-y*d;var M=[];if(Y.zValue=g,Y.lines=M,!(E>=g||g>=w))for(var U=0;X-1>U;U++)for(var L=v[U],N=v[U+1],V=0;x-1>V;V++)a=L[V],r=L[V+1],i=N[V],s=N[V+1],n=a>g,o=r>g,l=i>g,f=s>g,n!==o&&n!==l&&(p=V+(g-a)/(r-a),u=U,c=V,h=U+(g-a)/(i-a),M.push(p*S+A),M.push(u*O+T),M.push(c*S+A),M.push(h*O+T)),f!==o&&f!==l&&(p=V+1,u=U+1-(g-s)/(r-s),c=V+1-(g-s)/(i-s),h=U+1,M.push(p*S+A),M.push(u*O+T),M.push(c*S+A),M.push(h*O+T)),o!==l&&(p=(V+1-(g-r)/(i-r))*S+A,u=(U+(g-r)/(i-r))*O+T,o!==n&&(c=V+1-(g-r)/(a-r),h=U,M.push(p),M.push(u),M.push(c*S+A),M.push(h*O+T)),l!==n&&(c=V,h=U+1-(g-i)/(a-i),M.push(p),M.push(u),M.push(c*S+A),M.push(h*O+T)),o!==f&&(c=V+1,h=U+(g-r)/(s-r),M.push(p),M.push(u),M.push(c*S+A),M.push(h*O+T)),l!==f&&(c=V+(g-i)/(s-i),h=U+1,M.push(p),M.push(u),M.push(c*S+A),M.push(h*O+T)))}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:m}}function c(e,t){var a=e.yFactor,r=e.deltaX;e.isXYdata=!0;var i=[],s=0;e.data=[i];for(var n=e.firstX,o=e.firstY,l=!1,f=0;f<t.length;f++){var p=t.charCodeAt(f);if(13===p||10===p)l=!0;else if(l)break}for(var p,u=!0,c=!1,h=!1,g=0,d=!1,v=!1,m=0,F=!1,y=!1,X=!1,x=0;f<=t.length;f++)if(p=f===t.length?13:t.charCodeAt(f),v)13!==p&&10!==p||(u=!0,v=!1);else if(57>=p&&p>=48)y=!0,x>0?m+=(p-48)/Math.pow(10,x++):(m*=10,m+=p-48);else if(44===p||46===p)y=!0,x++;else{if(y){if(u)u=!1,h&&(X=!0);else if(X)X=!1;else{c&&(g=0===m?0:F?-m:m,h=!0,c=!1);for(var A=d?m-1:1,b=0;A>b;b++)h?o+=g:o=0===m?0:F?-m:m,i[s++]=n,i[s++]=o*a,n+=r}F=!1,m=0,x=0,y=!1,d=!1}if(74>p&&p>63)y=!0,h=!1,m=p-64;else if(p>96&&106>p)y=!0,h=!1,m=p-96,F=!0;else if(115===p)y=!0,d=!0,m=9;else if(p>82&&91>p)y=!0,d=!0,m=p-82;else if(p>73&&83>p)y=!0,c=!0,m=p-73;else if(p>105&&115>p)y=!0,c=!0,m=p-105,F=!0;else if(36===p&&36===t.charCodeAt(f+1))y=!0,v=!0;else if(37===p)y=!0,c=!0,m=0,F=!1;else if(45===p){var S=t.charCodeAt(f+1);(S>=48&&57>=S||44===S||46===S)&&(y=!0,h=!1,F=!0)}else 13!==p&&10!==p||(u=!0,v=!1)}}function h(e,t,a){var r=/\$\$.*/,i=/[,\t ]+/;e.isPeaktable=!0;var s,n,o,l,f,p=[];e.data=[p];var u=t.split(/,? *,?[;\r\n]+ */),c=0;for(s=1,n=u.length;n>s;s++)if(f=u[s].trim().replace(r,"").split(i),f.length%2===0)for(o=0,l=f.length;l>o;o+=2)p[c++]=parseFloat(f[o])*e.xFactor,p[c++]=parseFloat(f[o+1])*e.yFactor;else a.logs.push("Format error: "+f)}var g=/[, \t]{1,}/,d=["TIC",".RIC","SCANNUMBER"];return a}function i(e,t,a){return"boolean"==typeof t&&(a=t,t={}),a?s(e,t):f(e,t)}function s(e,t){return o||n(),new Promise(function(a){var r=Date.now()+""+Math.random();p[r]=a,o.postMessage(JSON.stringify({stamp:r,input:e,options:t}))})}function n(){var e=URL.createObjectURL(new Blob(["var getConverter ="+r.toString()+";var convert = getConverter(); onmessage = function (event) { var data = JSON.parse(event.data); postMessage(JSON.stringify({stamp: data.stamp, output: convert(data.input, data.options)})); };"],{type:"application/javascript"}));o=new Worker(e),URL.revokeObjectURL(e),o.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.stamp;p[a]&&p[a](t.output)})}var o,l=a(1),f=r(),p={};e.exports={convert:i}},function(e,t){"use strict";var a=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,r=/\$\$.*/,i=!1;e.exports=function(e,t,s){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1)),e.isXYdata=!0;var n=[],o=0;e.data=[n];var l,f,p,u=e.firstX,c=e.firstY,h=t.split(/[\r\n]+/);f=[];for(var g=1,d=h.length;d>g;g++)if(f=h[g].trim().replace(r,"").split(a),f.length>0){if(i){e.firstPoint||(e.firstPoint=+f[0]);var v=(f[0]-e.firstPoint)*e.xFactor+e.firstX;(l||0===l)&&(v+=e.deltaX),s.logs.push("Checking X value: currentX: "+u+" - expectedCurrentX: "+v)}for(var m=1,F=f.length;F>m;m++)if(1!==m||!l&&0!==l){if(f[m].length>0)if(p=f[m].charCodeAt(0),43===p||45===p||46===p||p>47&&58>p)l=null,c=+f[m],n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>63&&74>p)l=null,c=+(String.fromCharCode(p-16)+f[m].substring(1)),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>96&&106>p)l=null,c=1*-(String.fromCharCode(p-48)+f[m].substring(1)),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>82&&91>p||115===p){var y=String.fromCharCode(p-34)+f[m].substring(1)-1;115===p&&(y="9"+f[m].substring(1)-1);for(var X=0;y>X;X++)l&&(c+=l),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX}else 37===p?(l=+("0"+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX):p>73&&83>p?(l=1*(String.fromCharCode(p-25)+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX):p>105&&115>p&&(l=1*-(String.fromCharCode(p-57)+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX)}else l=null,p=f[m].charCodeAt(0)}}}])});
//# sourceMappingURL=jcampconverter.min.js.map