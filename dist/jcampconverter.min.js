!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JcampConverter=t():e.JcampConverter=t()}(this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var i=a[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";function r(){function e(e){for(var t=e.length,a=new Array(t),r=0;t>r;r++)a[r]=parseFloat(e[r]);return a}function t(t,o){o=o||{};var p=/^$/;o.keepRecordsRegExp&&(p=o.keepRecordsRegExp);var g,d,v,m,F,y,x,X,A,b=Date.now(),S={},T={};T.profiling=[],T.logs=[];var O=[];T.spectra=O,T.info={};var C={};if("string"!=typeof t)return T;for(T.profiling&&T.profiling.push({action:"Before split to LDRS",time:Date.now()-b}),m=t.split(/[\r\n]+##/),T.profiling&&T.profiling.push({action:"Split to LDRS",time:Date.now()-b}),m[0]&&(m[0]=m[0].replace(/^[\r\n ]*##/,"")),F=0,y=m.length;y>F;F++){if(g=m[F],x=g.indexOf("="),x>0?(d=g.substring(0,x),v=g.substring(x+1).trim()):(d=g,v=""),d=d.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===d&&(X=v.indexOf("\n"),-1===X&&(X=v.indexOf("\r")),X>0)){var E=-1,R=-1;if(A=v.substring(0,X).split(/[ ,;\t]+/),A[0].indexOf("++")>0){var w=A[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),Y=A[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");E=S.symbol.indexOf(w),R=S.symbol.indexOf(Y)}-1===E&&(E=0),-1===R&&(R=0),S.first&&(S.first.length>E&&(C.firstX=S.first[E]),S.first.length>R&&(C.firstY=S.first[R])),S.last&&(S.last.length>E&&(C.lastX=S.last[E]),S.last.length>R&&(C.lastY=S.last[R])),S.vardim&&S.vardim.length>E&&(C.nbPoints=S.vardim[E]),S.factor&&(S.factor.length>E&&(C.xFactor=S.factor[E]),S.factor.length>R&&(C.yFactor=S.factor[R])),S.units&&(S.units.length>E&&(C.xUnit=S.units[E]),S.units.length>R&&(C.yUnit=S.units[R])),C.datatable=A[0],A[1]&&A[1].indexOf("PEAKS")>-1?d="PEAKTABLE":A[1]&&(A[1].indexOf("XYDATA")||A[0].indexOf("++")>0)&&(d="XYDATA",C.deltaX=(C.lastX-C.firstX)/(C.nbPoints-1))}if("TITLE"===d)C.title=v;else if("DATATYPE"===d)C.dataType=v,v.indexOf("nD")>-1&&(T.twoD=!0);else if("NTUPLES"===d)v.indexOf("nD")>-1&&(T.twoD=!0);else if("XUNITS"===d)C.xUnit=v;else if("YUNITS"===d)C.yUnit=v;else if("FIRSTX"===d)C.firstX=parseFloat(v);else if("LASTX"===d)C.lastX=parseFloat(v);else if("FIRSTY"===d)C.firstY=parseFloat(v);else if("LASTY"===d)C.lastY=parseFloat(v);else if("NPOINTS"===d)C.nbPoints=parseFloat(v);else if("XFACTOR"===d)C.xFactor=parseFloat(v);else if("YFACTOR"===d)C.yFactor=parseFloat(v);else if("DELTAX"===d)C.deltaX=parseFloat(v);else if(".OBSERVEFREQUENCY"===d||"$SFO1"===d)C.observeFrequency||(C.observeFrequency=parseFloat(v));else if(".OBSERVENUCLEUS"===d)C.xType||(T.xType=v.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===d)T.indirectFrequency||(T.indirectFrequency=parseFloat(v));else if("$OFFSET"===d)T.shiftOffsetNum=0,T.shiftOffsetVal||(T.shiftOffsetVal=parseFloat(v));else if("$REFERENCEPOINT"===d);else if("VARNAME"===d)S.varname=v.split(h);else if("SYMBOL"===d)S.symbol=v.split(h);else if("VARTYPE"===d)S.vartype=v.split(h);else if("VARFORM"===d)S.varform=v.split(h);else if("VARDIM"===d)S.vardim=e(v.split(h));else if("UNITS"===d)S.units=v.split(h);else if("FACTOR"===d)S.factor=e(v.split(h));else if("FIRST"===d)S.first=e(v.split(h));else if("LAST"===d)S.last=e(v.split(h));else if("MIN"===d)S.min=e(v.split(h));else if("MAX"===d)S.max=e(v.split(h));else if(".NUCLEUS"===d)T.twoD&&(T.yType=v.split(h)[0]);else if("PAGE"===d){C.page=v.trim(),C.pageValue=parseFloat(v.replace(/^.*=/,"")),C.pageSymbol=C.page.replace(/=.*/,"");var P=S.symbol.indexOf(C.pageSymbol),D="";S.units&&S.units[P]&&(D=S.units[P]),T.indirectFrequency&&"PPM"!==D&&(C.pageValue/=T.indirectFrequency)}else"RETENTIONTIME"===d?C.pageValue=parseFloat(v):"XYDATA"===d?(n(T,C),v.match(/.*\+\+.*/)?o.fastParse===!1?l(C,v,T):(C.deltaX||(C.deltaX=(C.lastX-C.firstX)/(C.nbPoints-1)),u(C,v,T)):c(C,v,T),O.push(C),C={}):"PEAKTABLE"===d?(n(T,C),c(C,v,T),O.push(C),C={}):r(d)&&(C[a(d)]=v);d.match(p)&&(T.info[d]=v.trim())}if(T.profiling&&T.profiling.push({action:"Finished parsing",time:Date.now()-b}),Object.keys(S).length>0){for(var U=[],M=Object.keys(S),F=0;F<M.length;F++)for(var N=M[F],L=S[N],V=0;V<L.length;V++)U[V]||(U[V]={}),U[V][N]=L[V];T.ntuples=U}T.twoD&&(f(T),T.profiling&&T.profiling.push({action:"Finished countour plot calculation",time:Date.now()-b}),o.keepSpectra||delete T.spectra);var I=O.length>1&&(!O[0].dataType||O[0].dataType.match(/.*mass.*/i));if(I&&o.newGCMS&&(o.xy=!0),o.xy&&O.length>0)for(var F=0;F<O.length;F++){var C=O[F];if(C.data.length>0)for(var V=0;V<C.data.length;V++){for(var q=C.data[V],$={x:new Array(q.length/2),y:new Array(q.length/2)},k=0;k<q.length;k+=2)$.x[k/2]=q[k],$.y[k/2]=q[k+1];C.data[V]=$}}return I&&(o.newGCMS?i(T):s(T),T.profiling&&T.profiling.push({action:"Finished GCMS calculation",time:Date.now()-b})),T.profiling&&T.profiling.push({action:"Total time",time:Date.now()-b}),T}function a(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function r(e){return-1!==g.indexOf(e)}function i(e){var t,r=e.spectra,i=r.length,s={times:new Array(i),series:[{name:"ms",dimension:2,data:new Array(i)}]},n=[];for(t=0;t<g.length;t++){var o=a(g[t]);r[0][o]&&(n.push(o),s.series.push({name:o,dimension:1,data:new Array(i)}))}for(t=0;i>t;t++){var l=r[t];s.times[t]=l.pageValue;for(var f=0;f<n.length;f++)s.series[f+1].data[t]=parseFloat(l[n[f]]);l.data&&(s.series[0].data[t]=[l.data[0].x,l.data[0].y])}e.gcms=s}function s(e){var t,r=e.spectra,i=[];for(t=0;t<g.length;t++){var s=a(g[t]);r[0][s]&&i.push(s)}if(0!==i.length){var n={};for(n.gc={},n.ms=[],t=0;t<i.length;t++)n.gc[i[t]]=[];for(t=0;t<r.length;t++){for(var o=r[t],l=0;l<i.length;l++)n.gc[i[l]].push(o.pageValue),n.gc[i[l]].push(parseFloat(o[i[l]]));o.data&&(n.ms[t]=o.data[0])}e.gcms=n}}function n(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var a=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-a,t.lastX=t.lastX-a}}function o(e){for(var t=0,a=e[0].data[0][0],r=a,i=e.length,s=e[0].data[0].length/2,n=new Array(i),o=0;i>o;o++){n[o]=new Array(s);for(var l=e[o].data[0],f=0;s>f;f++){var p=l[2*f+1];n[o][f]=p,a>p&&(a=p),p>r&&(r=p),0!==o&&0!==f&&(t+=Math.abs(p-n[o][f-1])+Math.abs(p-n[o-1][f]))}}return{z:n,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[i-1].pageValue,minZ:a,maxZ:r,noise:t/((i-1)*(s-1)*2)}}function f(e){var t=o(e.spectra);e.contourLines=p(t),delete t.z,e.minMax=t}function p(e,t){for(var a,r,i,s,n,o,l,f,p,u,c,h,g,d=e.noise,v=e.z,m=[],F=7,y=v.length,x=v[0].length,X=e.minX,A=e.maxX,b=(A-X)/(x-1),S=e.minY,T=e.maxY,O=(T-S)/(y-1),C=e.minZ,E=e.maxZ,R=0;2*F>R;R++){var w={};m[R]=w;var Y=R%2;g=0===Y?(E-5*d)*Math.exp(R/2-F)+5*d:-(E-5*d)*Math.exp(R/2-F)-5*d;var P=[];if(w.zValue=g,w.lines=P,!(C>=g||g>=E))for(var D=0;y-1>D;D++)for(var U=v[D],M=v[D+1],N=0;x-1>N;N++)a=U[N],r=U[N+1],i=M[N],s=M[N+1],n=a>g,o=r>g,l=i>g,f=s>g,n!==o&&n!==l&&(p=N+(g-a)/(r-a),u=D,c=N,h=D+(g-a)/(i-a),P.push(p*b+X),P.push(u*O+S),P.push(c*b+X),P.push(h*O+S)),f!==o&&f!==l&&(p=N+1,u=D+1-(g-s)/(r-s),c=N+1-(g-s)/(i-s),h=D+1,P.push(p*b+X),P.push(u*O+S),P.push(c*b+X),P.push(h*O+S)),o!==l&&(p=(N+1-(g-r)/(i-r))*b+X,u=(D+(g-r)/(i-r))*O+S,o!==n&&(c=N+1-(g-r)/(a-r),h=D,P.push(p),P.push(u),P.push(c*b+X),P.push(h*O+S)),l!==n&&(c=N,h=D+1-(g-i)/(a-i),P.push(p),P.push(u),P.push(c*b+X),P.push(h*O+S)),o!==f&&(c=N+1,h=D+(g-r)/(s-r),P.push(p),P.push(u),P.push(c*b+X),P.push(h*O+S)),l!==f&&(c=N+(g-i)/(s-i),h=D+1,P.push(p),P.push(u),P.push(c*b+X),P.push(h*O+S)))}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:m}}function u(e,t){var a=e.yFactor,r=e.deltaX;e.isXYdata=!0;var i=[],s=0;e.data=[i];for(var n=e.firstX,o=e.firstY,l=!1,f=0;f<t.length;f++){var p=t.charCodeAt(f);if(13===p||10===p)l=!0;else if(l)break}for(var p,u=!0,c=!1,h=!1,g=0,d=!1,v=!1,m=0,F=!1,y=!1,x=!1,X=0;f<=t.length;f++)if(p=f===t.length?13:t.charCodeAt(f),v)13!==p&&10!==p||(u=!0,v=!1);else if(57>=p&&p>=48)y=!0,X>0?m+=(p-48)/Math.pow(10,X++):(m*=10,m+=p-48);else if(44===p||46===p)y=!0,X++;else{if(y){if(u)u=!1,h&&(x=!0);else if(x)x=!1;else{c&&(g=0===m?0:F?-m:m,h=!0,c=!1);for(var A=d?m-1:1,b=0;A>b;b++)h?o+=g:o=0===m?0:F?-m:m,i[s++]=n,i[s++]=o*a,n+=r}F=!1,m=0,X=0,y=!1,d=!1}if(74>p&&p>63)y=!0,h=!1,m=p-64;else if(p>96&&106>p)y=!0,h=!1,m=p-96,F=!0;else if(115===p)y=!0,d=!0,m=9;else if(p>82&&91>p)y=!0,d=!0,m=p-82;else if(p>73&&83>p)y=!0,c=!0,m=p-73;else if(p>105&&115>p)y=!0,c=!0,m=p-105,F=!0;else if(36===p&&36===t.charCodeAt(f+1))y=!0,v=!0;else if(37===p)y=!0,c=!0,m=0,F=!1;else if(45===p){var S=t.charCodeAt(f+1);(S>=48&&57>=S||44===S||46===S)&&(y=!0,h=!1,F=!0)}else 13!==p&&10!==p||(u=!0,v=!1)}}function c(e,t,a){var r=/\$\$.*/,i=/[,\t ]+/;e.isPeaktable=!0;var s,n,o,l,f,p=[];e.data=[p];var u=t.split(/,? *,?[;\r\n]+ */),c=0;for(s=1,n=u.length;n>s;s++)if(f=u[s].trim().replace(r,"").split(i),f.length%2===0)for(o=0,l=f.length;l>o;o+=2)p[c++]=parseFloat(f[o])*e.xFactor,p[c++]=parseFloat(f[o+1])*e.yFactor;else a.logs.push("Format error: "+f)}var h=/[, \t]{1,}/,g=["TIC",".RIC","SCANNUMBER"];return t}function i(e,t,a){return"boolean"==typeof t&&(a=t,t={}),a?s(e,t):f(e,t)}function s(e,t){return o||n(),new Promise(function(a){var r=Date.now()+""+Math.random();p[r]=a,o.postMessage(JSON.stringify({stamp:r,input:e,options:t}))})}function n(){var e=URL.createObjectURL(new Blob(["var getConverter ="+r.toString()+";var convert = getConverter(); onmessage = function (event) { var data = JSON.parse(event.data); postMessage(JSON.stringify({stamp: event.data.stamp, output: convert(data.input, data.options)})); };"],{type:"application/javascript"}));o=new Worker(e),URL.revokeObjectURL(e),o.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.stamp;p[a]&&p[a](t.output)})}var o,l=a(1),f=r(),p={};e.exports={convert:i}},function(e,t){"use strict";var a=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,r=/\$\$.*/,i=!1;e.exports=function(e,t,s){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1)),e.isXYdata=!0;var n=[],o=0;e.data=[n];var l,f,p,u=e.firstX,c=e.firstY,h=t.split(/[\r\n]+/);f=[];for(var g=1,d=h.length;d>g;g++)if(f=h[g].trim().replace(r,"").split(a),f.length>0){if(i){e.firstPoint||(e.firstPoint=+f[0]);var v=(f[0]-e.firstPoint)*e.xFactor+e.firstX;(l||0===l)&&(v+=e.deltaX),s.logs.push("Checking X value: currentX: "+u+" - expectedCurrentX: "+v)}for(var m=1,F=f.length;F>m;m++)if(1!==m||!l&&0!==l){if(f[m].length>0)if(p=f[m].charCodeAt(0),43===p||45===p||46===p||p>47&&58>p)l=null,c=+f[m],n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>63&&74>p)l=null,c=+(String.fromCharCode(p-16)+f[m].substring(1)),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>96&&106>p)l=null,c=1*-(String.fromCharCode(p-48)+f[m].substring(1)),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>82&&91>p||115===p){var y=String.fromCharCode(p-34)+f[m].substring(1)-1;115===p&&(y="9"+f[m].substring(1)-1);for(var x=0;y>x;x++)l&&(c+=l),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX}else 37===p?(l=+("0"+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX):p>73&&83>p?(l=1*(String.fromCharCode(p-25)+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX):p>105&&115>p&&(l=1*-(String.fromCharCode(p-57)+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX)}else l=null,p=f[m].charCodeAt(0)}}}])});
//# sourceMappingURL=jcampconverter.min.js.map