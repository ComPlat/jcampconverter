/** jcampconverter@2.10.0, MIT licensed. https://github.com/cheminfo-js/jcampconverter#readme */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JcampConverter=t():e.JcampConverter=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function a(){var e=/[, \t]+/,t=["TIC",".RIC","SCANNUMBER"];function r(e){for(var t=e.length,r=new Array(t),a=0;a<t;a++)r[a]=parseFloat(e[a]);return r}class a{}var i={keepRecordsRegExp:/^$/,xy:!1,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5};function n(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function s(e){return-1!==t.indexOf(e)}function o(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var r=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-r,t.lastX=t.lastX-r}}function l(e,t){return e-t}function f(e,t){var r=e.yFactor,a=e.deltaX;e.isXYdata=!0;var i=[];e.data=[i];for(var n,s=e.firstX,o=e.firstY,l=!1,f=0;f<t.length;f++)if(13===(n=t.charCodeAt(f))||10===n)l=!0;else if(l)break;for(var p=!0,u=!1,c=!1,h=0,g=!1,d=!1,m=0,v=!1,y=!1,x=!1,F=0;f<=t.length;f++)if(n=f===t.length?13:t.charCodeAt(f),d)13!==n&&10!==n||(p=!0,d=!1);else if(n<=57&&n>=48)y=!0,F>0?m+=(n-48)/Math.pow(10,F++):(m*=10,m+=n-48);else if(44===n||46===n)y=!0,F++;else{if(y){if(p)p=!1,c&&(x=!0);else if(x)x=!1;else{u&&(h=v?0-m:m,c=!0,u=!1);for(var A=g?m-1:1,b=0;b<A;b++)c?o+=h:o=v?0-m:m,i.push(s),i.push(o*r),s+=a}v=!1,m=0,F=0,y=!1,g=!1}if(n<74&&n>63)y=!0,c=!1,m=n-64;else if(n>96&&n<106)y=!0,c=!1,m=n-96,v=!0;else if(115===n)y=!0,g=!0,m=9;else if(n>82&&n<91)y=!0,g=!0,m=n-82;else if(n>73&&n<83)y=!0,u=!0,m=n-73;else if(n>105&&n<115)y=!0,u=!0,m=n-105,v=!0;else if(36===n&&36===t.charCodeAt(f+1))y=!0,d=!0;else if(37===n)y=!0,u=!0,m=0,v=!1;else if(45===n){var T=t.charCodeAt(f+1);(T>=48&&T<=57||44===T||46===T)&&(y=!0,p||(c=!1),v=!0)}else 13!==n&&10!==n||(p=!0,d=!1)}}function p(e,t,r){var a,i,n,s,o,l=/\$\$.*/,f=/[,\t ]+/;e.isPeaktable=!0;var p=[];e.data=[p];var u=t.split(/,? *,?[;\r\n]+ */);for(a=1,i=u.length;a<i;a++)if((o=u[a].trim().replace(l,"").split(f)).length%2==0)for(n=0,s=o.length;n<s;n+=2)p.push(parseFloat(o[n])*e.xFactor),p.push(parseFloat(o[n+1])*e.yFactor);else r.logs.push(`Format error: ${o}`)}return function(u,c){var h,g,d,m,v,y,x,F,A,b,T=!(c=Object.assign({},i,c)).withoutXY,X=Date.now(),O={},E={profiling:[],logs:[]},w=[];E.spectra=w,E.info={};var S=new a;if("string"!=typeof u)throw new TypeError("the JCAMP should be a string");for(E.profiling&&E.profiling.push({action:"Before split to LDRS",time:Date.now()-X}),m=u.split(/[\r\n]+##/),E.profiling&&E.profiling.push({action:"Split to LDRS",time:Date.now()-X}),m[0]&&(m[0]=m[0].replace(/^[\r\n ]*##/,"")),v=0,y=m.length;v<y;v++){if((F=(h=m[v]).indexOf("="))>0?(g=h.substring(0,F),d=h.substring(F+1).trim()):(g=h,d=""),"DATATABLE"===(g=g.replace(/[_ -]/g,"").toUpperCase())&&(-1===(A=d.indexOf("\n"))&&(A=d.indexOf("\r")),A>0)){var C=-1,R=-1;if((b=d.substring(0,A).split(/[ ,;\t]+/))[0].indexOf("++")>0){var Y=b[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),D=b[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");C=O.symbol.indexOf(Y),R=O.symbol.indexOf(D)}-1===C&&(C=0),-1===R&&(R=0),O.first&&(O.first.length>C&&(S.firstX=O.first[C]),O.first.length>R&&(S.firstY=O.first[R])),O.last&&(O.last.length>C&&(S.lastX=O.last[C]),O.last.length>R&&(S.lastY=O.last[R])),O.vardim&&O.vardim.length>C&&(S.nbPoints=O.vardim[C]),O.factor&&(O.factor.length>C&&(S.xFactor=O.factor[C]),O.factor.length>R&&(S.yFactor=O.factor[R])),O.units&&(O.units.length>C&&(S.xUnit=O.units[C]),O.units.length>R&&(S.yUnit=O.units[R])),S.datatable=b[0],b[1]&&b[1].indexOf("PEAKS")>-1?g="PEAKTABLE":b[1]&&(b[1].indexOf("XYDATA")||b[0].indexOf("++")>0)&&(g="XYDATA",S.deltaX=(S.lastX-S.firstX)/(S.nbPoints-1))}if("XYDATA"!==g)if("PEAKTABLE"!==g){if("TITLE"===g)S.title=d;else if("DATATYPE"===g)S.dataType=d,d.indexOf("nD")>-1&&(E.twoD=!0);else if("NTUPLES"===g)d.indexOf("nD")>-1&&(E.twoD=!0);else if("XUNITS"===g)S.xUnit=d;else if("YUNITS"===g)S.yUnit=d;else if("FIRSTX"===g)S.firstX=parseFloat(d);else if("LASTX"===g)S.lastX=parseFloat(d);else if("FIRSTY"===g)S.firstY=parseFloat(d);else if("LASTY"===g)S.lastY=parseFloat(d);else if("NPOINTS"===g)S.nbPoints=parseFloat(d);else if("XFACTOR"===g)S.xFactor=parseFloat(d);else if("YFACTOR"===g)S.yFactor=parseFloat(d);else if("DELTAX"===g)S.deltaX=parseFloat(d);else if(".OBSERVEFREQUENCY"===g||"$SFO1"===g)S.observeFrequency||(S.observeFrequency=parseFloat(d));else if(".OBSERVENUCLEUS"===g)S.xType||(E.xType=d.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===g)E.indirectFrequency||(E.indirectFrequency=parseFloat(d));else if("$OFFSET"===g)E.shiftOffsetNum=0,E.shiftOffsetVal||(E.shiftOffsetVal=parseFloat(d));else if("$REFERENCEPOINT"===g);else if("VARNAME"===g)O.varname=d.split(e);else if("SYMBOL"===g)O.symbol=d.split(e);else if("VARTYPE"===g)O.vartype=d.split(e);else if("VARFORM"===g)O.varform=d.split(e);else if("VARDIM"===g)O.vardim=r(d.split(e));else if("UNITS"===g)O.units=d.split(e);else if("FACTOR"===g)O.factor=r(d.split(e));else if("FIRST"===g)O.first=r(d.split(e));else if("LAST"===g)O.last=r(d.split(e));else if("MIN"===g)O.min=r(d.split(e));else if("MAX"===g)O.max=r(d.split(e));else if(".NUCLEUS"===g)E.twoD&&(E.yType=d.split(e)[0]);else if("PAGE"===g){S.page=d.trim(),S.pageValue=parseFloat(d.replace(/^.*=/,"")),S.pageSymbol=S.page.replace(/[=].*/,"");var L=O.symbol.indexOf(S.pageSymbol),M="";O.units&&O.units[L]&&(M=O.units[L]),E.indirectFrequency&&"PPM"!==M&&(S.pageValue/=E.indirectFrequency)}else"RETENTIONTIME"===g?S.pageValue=parseFloat(d):s(g)&&(S[n(g)]=d);g.match(c.keepRecordsRegExp)&&(E.info[g]=d.trim())}else T&&(o(E,S),p(S,d,E),w.push(S),S=new a);else T&&(o(E,S),d.match(/.*\+\+.*/)?(S.deltaX||(S.deltaX=(S.lastX-S.firstX)/(S.nbPoints-1)),f(S,d)):p(S,d,E),w.push(S),S=new a)}if(E.profiling&&E.profiling.push({action:"Finished parsing",time:Date.now()-X}),Object.keys(O).length>0){var N=[],P=Object.keys(O);for(v=0;v<P.length;v++){var U=P[v],V=O[U];for(x=0;x<V.length;x++)N[x]||(N[x]={}),N[x][U]=V[x]}E.ntuples=N}if(E.twoD&&T&&(function(e,t){var r=function(e){for(var t=e[0].data[0][0],r=t,a=e.length,i=e[0].data[0].length/2,n=new Array(a),s=0;s<a;s++){n[s]=new Array(i);for(var o=e[s].data[0],f=0;f<i;f++){var p=o[2*f+1];n[s][f]=p,p<t&&(t=p),p>r&&(r=p)}}return{z:n,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[a-1].pageValue,minZ:t,maxZ:r,noise:(u=n[0].map(Math.abs),c=(u=u.sort(l)).length,u[Math.floor(c/2)])};var u,c}(e.spectra);t.noContour||(e.contourLines=function(e,t){for(var r,a,i,n,s,o,l,f,p,u,c,h,g,d=e.noise,m=e.z,v=m.length,y=m[0].length,x=e.minX,F=(e.maxX-x)/(y-1),A=e.minY,b=(e.maxY-A)/(v-1),T=e.minZ,X=e.maxZ,O=2*t.nbContourLevels,E=new Array(O),w=0;w<O;w++){var S={};E[w]=S;var C=w%2,R=(X-t.noiseMultiplier*d)*Math.exp((w>>1)-t.nbContourLevels);g=0===C?R+t.noiseMultiplier*d:0-R-t.noiseMultiplier*d;var Y=[];if(S.zValue=g,S.lines=Y,!(g<=T||g>=X))for(var D=0;D<v-1;D++)for(var L=m[D],M=m[D+1],N=0;N<y-1;N++)r=L[N],a=L[N+1],i=M[N],n=M[N+1],l=i>g,f=n>g,(s=r>g)!=(o=a>g)&&s!==l&&(p=N+(g-r)/(a-r),u=D,c=N,h=D+(g-r)/(i-r),Y.push(p*F+x),Y.push(u*b+A),Y.push(c*F+x),Y.push(h*b+A)),f!==o&&f!==l&&(p=N+1,u=D+1-(g-n)/(a-n),c=N+1-(g-n)/(i-n),h=D+1,Y.push(p*F+x),Y.push(u*b+A),Y.push(c*F+x),Y.push(h*b+A)),o!==l&&(p=(N+1-(g-a)/(i-a))*F+x,u=(D+(g-a)/(i-a))*b+A,o!==s&&(c=N+1-(g-a)/(r-a),h=D,Y.push(p),Y.push(u),Y.push(c*F+x),Y.push(h*b+A)),l!==s&&(c=N,h=D+1-(g-i)/(r-i),Y.push(p),Y.push(u),Y.push(c*F+x),Y.push(h*b+A)),o!==f&&(c=N+1,h=D+(g-a)/(n-a),Y.push(p),Y.push(u),Y.push(c*F+x),Y.push(h*b+A)),l!==f&&(c=N+(g-i)/(n-i),h=D+1,Y.push(p),Y.push(u),Y.push(c*F+x),Y.push(h*b+A)))}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:E}}(r,t),delete r.z),e.minMax=r}(E,c),E.profiling&&E.profiling.push({action:"Finished countour plot calculation",time:Date.now()-X}),c.keepSpectra||delete E.spectra),c.chromatogram&&(c.xy=!0),c.xy&&T&&w.length>0)for(v=0;v<w.length;v++)if((S=w[v]).data.length>0)for(x=0;x<S.data.length;x++){for(var I=S.data[x],$={x:new Array(I.length/2),y:new Array(I.length/2)},j=0;j<I.length;j+=2)$.x[j/2]=I[j],$.y[j/2]=I[j+1];S.data[x]=$}return c.chromatogram&&(E.spectra.length>1?function(e){var r,a=e.spectra,i=a.length,s={times:new Array(i),series:{ms:{dimension:2,data:new Array(i)}}},o=[];for(r=0;r<t.length;r++){var l=n(t[r]);a[0][l]&&(o.push(l),s.series[l]={dimension:1,data:new Array(i)})}for(r=0;r<i;r++){var f=a[r];s.times[r]=f.pageValue;for(var p=0;p<o.length;p++)s.series[o[p]].data[r]=parseFloat(f[o[p]]);f.data&&(s.series.ms.data[r]=[f.data[0].x,f.data[0].y])}e.chromatogram=s}(E):function(e){var t=e.spectra[0].data[0];e.chromatogram={times:t.x.slice(),series:{intensity:{dimension:1,data:t.y.slice()}}}}(E),E.profiling&&E.profiling.push({action:"Finished chromatogram calculation",time:Date.now()-X})),E.profiling&&E.profiling.push({action:"Total time",time:Date.now()-X}),E}}var i=a();var n,s={};e.exports={convert:function(e,t,r){return"boolean"==typeof t&&(r=t,t={}),r?function(e,t){var r;return n||(r=URL.createObjectURL(new Blob([`var getConverter =${a.toString()};var convert = getConverter(); onmessage = function (event) { var data = JSON.parse(event.data); postMessage(JSON.stringify({stamp: data.stamp, output: convert(data.input, data.options)})); };`],{type:"application/javascript"})),n=new Worker(r),URL.revokeObjectURL(r),n.addEventListener("message",function(e){var t=JSON.parse(e.data),r=t.stamp;s[r]&&s[r](t.output)})),new Promise(function(r){var a=`${Date.now()}${Math.random()}`;s[a]=r,n.postMessage(JSON.stringify({stamp:a,input:e,options:t}))})}(e,t):i(e,t)},createTree:function(e,t={}){var r=t.flatten,a=void 0!==r&&r;if("string"!=typeof e)throw new TypeError("the JCAMP should be a string");for(var i,n=e.split(/[\r\n]+/),s=[],o=[],l=[],f=0,p=0;p<n.length;p++){var u=n[p];if("##NTUPLES"===u.substring(0,9)&&f++,"##TITLE"===u.substring(0,7))o.push({title:u.substring(8).trim(),jcamp:`${u}\n`,children:[]}),i=o[o.length-1],s.push(i);else if("##END"===u.substring(0,5)&&0===f){i.jcamp+=`${u}\n`;var c=o.pop();0!==o.length?(i=o[o.length-1]).children.push(c):(i=void 0,l.push(c))}else if(i&&i.jcamp){i.jcamp+=`${u}\n`;var h=u.match(/^##(.*?)=(.+)/);h&&"DATATYPE"===h[1].replace(/[ _-]/g,"").toUpperCase()&&(i.dataType=h[2].trim())}"##END"===u.substring(0,5)&&f>0&&f--}return a?(s.forEach(e=>{e.children=void 0}),s):l}}}])});