!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JcampConverter=t():e.JcampConverter=t()}(this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var i=a[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";function r(){function e(e){for(var t=e.length,a=new Array(t),r=0;r<t;r++)a[r]=parseFloat(e[r]);return a}function t(){}function a(a,f){f=f||{};var u=/^$/;f.keepRecordsRegExp&&(u=f.keepRecordsRegExp);var d,v,m,F,y,X,x,A,b,C=!f.withoutXY,S=Date.now(),T={},O={};O.profiling=[],O.logs=[];var E=[];O.spectra=E,O.info={};var w=new t;if("string"!=typeof a)return O;for(O.profiling&&O.profiling.push({action:"Before split to LDRS",time:Date.now()-S}),F=a.split(/[\r\n]+##/),O.profiling&&O.profiling.push({action:"Split to LDRS",time:Date.now()-S}),F[0]&&(F[0]=F[0].replace(/^[\r\n ]*##/,"")),y=0,X=F.length;y<X;y++){if(d=F[y],x=d.indexOf("="),x>0?(v=d.substring(0,x),m=d.substring(x+1).trim()):(v=d,m=""),v=v.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===v&&(A=m.indexOf("\n"),A===-1&&(A=m.indexOf("\r")),A>0)){var R=-1,Y=-1;if(b=m.substring(0,A).split(/[ ,;\t]+/),b[0].indexOf("++")>0){var P=b[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),D=b[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");R=T.symbol.indexOf(P),Y=T.symbol.indexOf(D)}R===-1&&(R=0),Y===-1&&(Y=0),T.first&&(T.first.length>R&&(w.firstX=T.first[R]),T.first.length>Y&&(w.firstY=T.first[Y])),T.last&&(T.last.length>R&&(w.lastX=T.last[R]),T.last.length>Y&&(w.lastY=T.last[Y])),T.vardim&&T.vardim.length>R&&(w.nbPoints=T.vardim[R]),T.factor&&(T.factor.length>R&&(w.xFactor=T.factor[R]),T.factor.length>Y&&(w.yFactor=T.factor[Y])),T.units&&(T.units.length>R&&(w.xUnit=T.units[R]),T.units.length>Y&&(w.yUnit=T.units[Y])),w.datatable=b[0],b[1]&&b[1].indexOf("PEAKS")>-1?v="PEAKTABLE":b[1]&&(b[1].indexOf("XYDATA")||b[0].indexOf("++")>0)&&(v="XYDATA",w.deltaX=(w.lastX-w.firstX)/(w.nbPoints-1))}if("XYDATA"!==v)if("PEAKTABLE"!==v){if("TITLE"===v)w.title=m;else if("DATATYPE"===v)w.dataType=m,m.indexOf("nD")>-1&&(O.twoD=!0);else if("NTUPLES"===v)m.indexOf("nD")>-1&&(O.twoD=!0);else if("XUNITS"===v)w.xUnit=m;else if("YUNITS"===v)w.yUnit=m;else if("FIRSTX"===v)w.firstX=parseFloat(m);else if("LASTX"===v)w.lastX=parseFloat(m);else if("FIRSTY"===v)w.firstY=parseFloat(m);else if("LASTY"===v)w.lastY=parseFloat(m);else if("NPOINTS"===v)w.nbPoints=parseFloat(m);else if("XFACTOR"===v)w.xFactor=parseFloat(m);else if("YFACTOR"===v)w.yFactor=parseFloat(m);else if("DELTAX"===v)w.deltaX=parseFloat(m);else if(".OBSERVEFREQUENCY"===v||"$SFO1"===v)w.observeFrequency||(w.observeFrequency=parseFloat(m));else if(".OBSERVENUCLEUS"===v)w.xType||(O.xType=m.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===v)O.indirectFrequency||(O.indirectFrequency=parseFloat(m));else if("$OFFSET"===v)O.shiftOffsetNum=0,O.shiftOffsetVal||(O.shiftOffsetVal=parseFloat(m));else if("$REFERENCEPOINT"===v);else if("VARNAME"===v)T.varname=m.split(g);else if("SYMBOL"===v)T.symbol=m.split(g);else if("VARTYPE"===v)T.vartype=m.split(g);else if("VARFORM"===v)T.varform=m.split(g);else if("VARDIM"===v)T.vardim=e(m.split(g));else if("UNITS"===v)T.units=m.split(g);else if("FACTOR"===v)T.factor=e(m.split(g));else if("FIRST"===v)T.first=e(m.split(g));else if("LAST"===v)T.last=e(m.split(g));else if("MIN"===v)T.min=e(m.split(g));else if("MAX"===v)T.max=e(m.split(g));else if(".NUCLEUS"===v)O.twoD&&(O.yType=m.split(g)[0]);else if("PAGE"===v){w.page=m.trim(),w.pageValue=parseFloat(m.replace(/^.*=/,"")),w.pageSymbol=w.page.replace(/=.*/,"");var M=T.symbol.indexOf(w.pageSymbol),U="";T.units&&T.units[M]&&(U=T.units[M]),O.indirectFrequency&&"PPM"!==U&&(w.pageValue/=O.indirectFrequency)}else"RETENTIONTIME"===v?w.pageValue=parseFloat(m):i(v)&&(w[r(v)]=m);v.match(u)&&(O.info[v]=m.trim())}else C&&(o(O,w),h(w,m,O),E.push(w),w=new t);else C&&(o(O,w),m.match(/.*\+\+.*/)?f.fastParse===!1?l(w,m,O):(w.deltaX||(w.deltaX=(w.lastX-w.firstX)/(w.nbPoints-1)),c(w,m,O)):h(w,m,O),E.push(w),w=new t)}if(O.profiling&&O.profiling.push({action:"Finished parsing",time:Date.now()-S}),Object.keys(T).length>0){for(var L=[],N=Object.keys(T),y=0;y<N.length;y++)for(var V=N[y],I=T[V],q=0;q<I.length;q++)L[q]||(L[q]={}),L[q][V]=I[q];O.ntuples=L}O.twoD&&C&&(p(O,f),O.profiling&&O.profiling.push({action:"Finished countour plot calculation",time:Date.now()-S}),f.keepSpectra||delete O.spectra);var $=E.length>1&&(!E[0].dataType||E[0].dataType.match(/.*mass.*/i));if($&&f.newGCMS&&(f.xy=!0),f.xy&&C&&E.length>0)for(var y=0;y<E.length;y++){var w=E[y];if(w.data.length>0)for(var q=0;q<w.data.length;q++){for(var k=w.data[q],B={x:new Array(k.length/2),y:new Array(k.length/2)},j=0;j<k.length;j+=2)B.x[j/2]=k[j],B.y[j/2]=k[j+1];w.data[q]=B}}return $&&C&&(f.newGCMS?s(O):n(O),O.profiling&&O.profiling.push({action:"Finished GCMS calculation",time:Date.now()-S})),O.profiling&&O.profiling.push({action:"Total time",time:Date.now()-S}),O}function r(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function i(e){return d.indexOf(e)!==-1}function s(e){var t,a=e.spectra,i=a.length,s={times:new Array(i),series:[{name:"ms",dimension:2,data:new Array(i)}]},n=[];for(t=0;t<d.length;t++){var o=r(d[t]);a[0][o]&&(n.push(o),s.series.push({name:o,dimension:1,data:new Array(i)}))}for(t=0;t<i;t++){var l=a[t];s.times[t]=l.pageValue;for(var f=0;f<n.length;f++)s.series[f+1].data[t]=parseFloat(l[n[f]]);l.data&&(s.series[0].data[t]=[l.data[0].x,l.data[0].y])}e.gcms=s}function n(e){var t,a=e.spectra,i=[];for(t=0;t<d.length;t++){var s=r(d[t]);a[0][s]&&i.push(s)}if(0!==i.length){var n={};for(n.gc={},n.ms=[],t=0;t<i.length;t++)n.gc[i[t]]=[];for(t=0;t<a.length;t++){for(var o=a[t],l=0;l<i.length;l++)n.gc[i[l]].push(o.pageValue),n.gc[i[l]].push(parseFloat(o[i[l]]));o.data&&(n.ms[t]=o.data[0])}e.gcms=n}}function o(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var a=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-a,t.lastX=t.lastX-a}}function f(e){for(var t=0,a=e[0].data[0][0],r=a,i=e.length,s=e[0].data[0].length/2,n=new Array(i),o=0;o<i;o++){n[o]=new Array(s);for(var l=e[o].data[0],f=0;f<s;f++){var p=l[2*f+1];n[o][f]=p,p<a&&(a=p),p>r&&(r=p),0!==o&&0!==f&&(t+=Math.abs(p-n[o][f-1])+Math.abs(p-n[o-1][f]))}}return{z:n,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[i-1].pageValue,minZ:a,maxZ:r,noise:t/((i-1)*(s-1)*2)}}function p(e,t){var a=f(e.spectra);t.noContour||(e.contourLines=u(a,t),delete a.z),e.minMax=a}function u(e,t){for(var a,r,i,s,n,o,l,f,p,u,c,h,g,d=e.noise,v=e.z,m=t.nbContourLevels||7,F=void 0===t.noiseMultiplier?5:t.noiseMultiplier,y=v.length,X=v[0].length,x=e.minX,A=e.maxX,b=(A-x)/(X-1),C=e.minY,S=e.maxY,T=(S-C)/(y-1),O=e.minZ,E=e.maxZ,w=2*m,R=new Array(w),Y=0;Y<w;Y++){var P={};R[Y]=P;var D=Y%2,M=(E-F*d)*Math.exp((Y>>1)-m);g=0===D?M+F*d:0-M-F*d;var U=[];if(P.zValue=g,P.lines=U,!(g<=O||g>=E))for(var L=0;L<y-1;L++)for(var N=v[L],V=v[L+1],I=0;I<X-1;I++)a=N[I],r=N[I+1],i=V[I],s=V[I+1],n=a>g,o=r>g,l=i>g,f=s>g,n!==o&&n!==l&&(p=I+(g-a)/(r-a),u=L,c=I,h=L+(g-a)/(i-a),U.push(p*b+x),U.push(u*T+C),U.push(c*b+x),U.push(h*T+C)),f!==o&&f!==l&&(p=I+1,u=L+1-(g-s)/(r-s),c=I+1-(g-s)/(i-s),h=L+1,U.push(p*b+x),U.push(u*T+C),U.push(c*b+x),U.push(h*T+C)),o!==l&&(p=(I+1-(g-r)/(i-r))*b+x,u=(L+(g-r)/(i-r))*T+C,o!==n&&(c=I+1-(g-r)/(a-r),h=L,U.push(p),U.push(u),U.push(c*b+x),U.push(h*T+C)),l!==n&&(c=I,h=L+1-(g-i)/(a-i),U.push(p),U.push(u),U.push(c*b+x),U.push(h*T+C)),o!==f&&(c=I+1,h=L+(g-r)/(s-r),U.push(p),U.push(u),U.push(c*b+x),U.push(h*T+C)),l!==f&&(c=I+(g-i)/(s-i),h=L+1,U.push(p),U.push(u),U.push(c*b+x),U.push(h*T+C)))}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:R}}function c(e,t){var a=e.yFactor,r=e.deltaX;e.isXYdata=!0;var i=[];e.data=[i];for(var s=e.firstX,n=e.firstY,o=!1,l=0;l<t.length;l++){var f=t.charCodeAt(l);if(13===f||10===f)o=!0;else if(o)break}for(var f,p=!0,u=!1,c=!1,h=0,g=!1,d=!1,v=0,m=!1,F=!1,y=!1,X=0;l<=t.length;l++)if(f=l===t.length?13:t.charCodeAt(l),d)13!==f&&10!==f||(p=!0,d=!1);else if(f<=57&&f>=48)F=!0,X>0?v+=(f-48)/Math.pow(10,X++):(v*=10,v+=f-48);else if(44===f||46===f)F=!0,X++;else{if(F){if(p)p=!1,c&&(y=!0);else if(y)y=!1;else{u&&(h=m?0-v:v,c=!0,u=!1);for(var x=g?v-1:1,A=0;A<x;A++)c?n+=h:n=m?0-v:v,i.push(s),i.push(n*a),s+=r}m=!1,v=0,X=0,F=!1,g=!1}if(f<74&&f>63)F=!0,c=!1,v=f-64;else if(f>96&&f<106)F=!0,c=!1,v=f-96,m=!0;else if(115===f)F=!0,g=!0,v=9;else if(f>82&&f<91)F=!0,g=!0,v=f-82;else if(f>73&&f<83)F=!0,u=!0,v=f-73;else if(f>105&&f<115)F=!0,u=!0,v=f-105,m=!0;else if(36===f&&36===t.charCodeAt(l+1))F=!0,d=!0;else if(37===f)F=!0,u=!0,v=0,m=!1;else if(45===f){var b=t.charCodeAt(l+1);(b>=48&&b<=57||44===b||46===b)&&(F=!0,c=!1,m=!0)}else 13!==f&&10!==f||(p=!0,d=!1)}}function h(e,t,a){var r=/\$\$.*/,i=/[,\t ]+/;e.isPeaktable=!0;var s,n,o,l,f,p=[];e.data=[p];var u=t.split(/,? *,?[;\r\n]+ */);for(s=1,n=u.length;s<n;s++)if(f=u[s].trim().replace(r,"").split(i),f.length%2===0)for(o=0,l=f.length;o<l;o+=2)p.push(parseFloat(f[o])*e.xFactor),p.push(parseFloat(f[o+1])*e.yFactor);else a.logs.push("Format error: "+f)}var g=/[, \t]{1,}/,d=["TIC",".RIC","SCANNUMBER"];return a}function i(e,t,a){return"boolean"==typeof t&&(a=t,t={}),a?s(e,t):f(e,t)}function s(e,t){return o||n(),new Promise(function(a){var r=Date.now()+""+Math.random();p[r]=a,o.postMessage(JSON.stringify({stamp:r,input:e,options:t}))})}function n(){var e=URL.createObjectURL(new Blob(["var getConverter ="+r.toString()+";var convert = getConverter(); onmessage = function (event) { var data = JSON.parse(event.data); postMessage(JSON.stringify({stamp: data.stamp, output: convert(data.input, data.options)})); };"],{type:"application/javascript"}));o=new Worker(e),URL.revokeObjectURL(e),o.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.stamp;p[a]&&p[a](t.output)})}var o,l=a(1),f=r(),p={};e.exports={convert:i}},function(e,t){"use strict";var a=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,r=/\$\$.*/,i=!1;e.exports=function(e,t,s){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1)),e.isXYdata=!0;var n=[],o=0;e.data=[n];var l,f,p,u=e.firstX,c=e.firstY,h=t.split(/[\r\n]+/);f=[];for(var g=1,d=h.length;g<d;g++)if(f=h[g].trim().replace(r,"").split(a),f.length>0){if(i){e.firstPoint||(e.firstPoint=+f[0]);var v=(f[0]-e.firstPoint)*e.xFactor+e.firstX;(l||0===l)&&(v+=e.deltaX),s.logs.push("Checking X value: currentX: "+u+" - expectedCurrentX: "+v)}for(var m=1,F=f.length;m<F;m++)if(1!==m||!l&&0!==l){if(f[m].length>0)if(p=f[m].charCodeAt(0),43===p||45===p||46===p||p>47&&p<58)l=null,c=+f[m],n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>63&&p<74)l=null,c=+(String.fromCharCode(p-16)+f[m].substring(1)),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>96&&p<106)l=null,c=1*-(String.fromCharCode(p-48)+f[m].substring(1)),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX;else if(p>82&&p<91||115===p){var y=String.fromCharCode(p-34)+f[m].substring(1)-1;115===p&&(y="9"+f[m].substring(1)-1);for(var X=0;X<y;X++)l&&(c+=l),n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX}else 37===p?(l=+("0"+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX):p>73&&p<83?(l=1*(String.fromCharCode(p-25)+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX):p>105&&p<115&&(l=1*-(String.fromCharCode(p-57)+f[m].substring(1)),c+=l,n[o++]=u,n[o++]=c*e.yFactor,u+=e.deltaX)}else l=null,p=f[m].charCodeAt(0)}}}])});
//# sourceMappingURL=jcampconverter.min.js.map